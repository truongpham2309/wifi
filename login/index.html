<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>Wifi Platform</title>
    <link rel='SHORTCUT ICON' href='http://truongpham.id.vn/wifi/login/favicon.ico' type='image/x-icon' />
    <script type="text/javascript" src="http://truongpham.id.vn/wifi/login/scripts/jquery-1.10.2.min.js"></script>
    <link href="http://truongpham.id.vn/wifi/login/css/font-awesome.min.css" rel="stylesheet">
    <style>
        body{
            font-family:arial;
        }
        #for-process-loading{
            margin:0px;
            padding:0px;
            width:100%;
            height:100vh;
            background-color:#fff;
		    opacity:0.5;
            position:fixed;
            top:0px;
            left:0px;
            z-index:100;
        }
        #for-process-loading-img{
            margin:0px;
		    padding:0px;
		    width:100%;
		    height:100vh;
		    position:absolute;
		    top:0px;
		    left:0px;
		    z-index:101;
		    background-image:url('http://truongpham.id.vn/wifi/login/templates/loading.gif');
            background-position:center center;
            background-repeat:no-repeat;
	    }
	    .for-loading{
		    display:none;
	    }
    #waiting5s{
            margin:0px;
            padding:1px 0px;
            width:100%;
            height:15px;
            background-color:#ffea00;
            position:fixed;
    top:0px;
            left:0px;
            color:#003cff;
            text-align:left;
            font-size:10px;
            font-family:Arial;
            display:none;
        }
        .fb-fake-like{
            margin:0 auto;
            padding:0px;
            margin-bottom:10px;
            width:57px;
            height:24px;
            background-image:url('http://truongpham.id.vn/wifi/login/templates/button-facebook-like.png');
    background-position:center center;
    background-repeat:no-repeat;
            cursor:pointer;
        }
        .for-login-like-pane{
            margin:0 auto;
            margin-top:10px;
            margin-bottom:10px;
            padding:10px 0px 0px 0px;
            background-color:#f9fcfe;
            border:1px solid #ccc;
            border-left:none;
            border-right:none;
            width:100%;
            display:none;
        }
        .for-login-like-pane p{
        margin:0px 0px 10px 0px;
        padding:0px;
        color:#000;
            font-family:Arial;
        font-size:12px;
        text-align:center;
    }
        .fb-page, .fb-page iframe[style], .fb-page span {
        width: 100% !important;
    }
        .fb-page {text-align: center;}
        .fb_iframe_widget {display: block !important;}
    </style>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WJGFRWH03P"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-WJGFRWH03P');
</script>
</head>
<body>
    
    <script>
        /*
        ============
        SETTING DATA
        ============
        */
        var ViewEditMode = false;
        var cVouchers = [];

        // DYNAMIC
        var _running_diamondplaza = 0;
        var _login_option_used = '13';
        var _running_owner = 'demo';
        var _running_tracking_splash_id = '';
        var _running_campaign_used = '0';
        var _running_campaign_id = '';
        var _running_google_appid = '96872117153-e64prbso3cit83ml9l41gtmoedin0qv3.apps.googleusercontent.com';
        var _running_fb_appid = '3302780903323748';
        var _running_auto_action = 0;
        var _running_user_id = '85d246ce-db54-4977-a0f0-70201f9697af';
        var _running_client_mac = 'Empty';
        var _running_location_id = '7ff0f82a-a786-40de-8823-ecd524a98a52';
        var _running_template_id = 'iao-din--uyn-';
        var _running_template_version = '1';
        var _running_login_option = 'button';
        var _running_login_option_question_group = '';
        var _running_login_option_question_answred = '';
        var _running_login_option_question_last_answer_date = '';
        var _running_login_option_question = ['1','1'];
        var _running_login_option_question_ids = [];
        var _running_login_option_question_values = [];
        var _running_login_option_question_types = [];
        var _running_login_option_question_required = [];
        var _running_login_option_question_goal_id = [];
        var _running_login_option_question_personal = [];
        var _running_ip_local = '115.78.134.97';
        var _running_ip_public = '115.78.134.97';

        var _running_action_portal = "http://securelogin.arubanetworks.com/cgi-bin/login";
        var _running_langding_page_id = '1fb4adf3-26a9-44d6-b1f2-ec452bdb383a';
        var _running_langding_page = 'http://truongpham.id.vn/wifi/prelandingzalo.html?id=benhvienxuyena&auto=1';
        var _running_langding_page_tracking = '0';
        var _running_wifi_login_names = ['cmd','user','password','Login'];
        var _running_wifi_login_values = ['authenticate','bvxa','bvxa123','J%27accepte+%7C+I+Agree'];
        var _running_wifi_login = 'cmd,user,password,Login';
        var _running_page_to_like_url = '';
        var _running_placeid_to_checkin = '';
        var _running_ready_to_checkin = false;
        var AutoSecBegin = _running_auto_action;
        var _running_post_type = '1';
        var _running_openmesh_login = '';
        var _running_account_kit_state = '';

        // PERSONAL INFORMATION COLLECTION

        var _mac_phone_found = '0';              var _phone_found = '';
        var _mac_name_found = '0';                var _name_found = '';
        var _mac_email_found = '0';              var _email_found = '';
        var _mac_birthday_found = '0';        var _birthday_found = '01/01/0001';
        var _mac_birthday_date_found = '1';
        var _mac_birthday_year_found = '1';
        var _mac_gender_found = '0';            var _gender_found = '2';
        var _mac_cmnd_found = '0';                var _cmnd_found = '';
        var _mac_is_new_user = '0';
        var _mac_phone_verify = '0';
        var _mac_email_verify = '0';
        var _mac_gender_verify = '0';
        var _mac_birthday_verify = '0';
        var _mac_first_visit_of_day = '1';
        var _logged_facebook = '0';
        var _logged_google = '0';
        var _logged_zalo = '0';
        var _mac_return_this_location_count_in_year = '0';

        var current_user_data = {
            name: '',
            day_birthday: '01',
            month_birthday: '01',
            year_birthday: '0001',
            date_birthday_exist: '0',
            year_birthday_exist: '0',
            gender: 2,
            mac: 'Empty',
            phone: '',
            email: '',
            location: 'demo-dd-57044'
        };

        // FIXED
        var _running_action_host = 'http://truongpham.id.vn/wifi/login/';
        var _running_action_save_tracking_splash_page = 'http://truongpham.id.vn/wifi/login/ClientBusiness/TrackingSplashPage';
        var _running_action_save_tracking_langding_page = 'http://truongpham.id.vn/wifi/login/ClientBusiness/TrackingLangdingPage';
        var _running_action_save_fb = 'http://truongpham.id.vn/wifi/login/ClientBusiness/SaveFB';
        var _running_action_save_google = 'http://truongpham.id.vn/wifi/login/ClientBusiness/SaveGoogle';
        var _running_action_save_answer = 'http://truongpham.id.vn/wifi/login/ClientBusiness/SaveAnswer';
        var _running_action_check_data = 'http://truongpham.id.vn/wifi/login/ClientBusiness/CheckData';
        var _running_action_login_wifi = 'http://truongpham.id.vn/wifi/login/ClientBusiness/LoginPostRaw';
        var _running_action_create_login_code_email = 'http://truongpham.id.vn/wifi/login/ClientBusiness/CreateLoginURLAndEmail';
        var _running_action_create_login_code_sms = 'http://truongpham.id.vn/wifi/login/ClientBusiness/CreateLoginCodeAndSMS';
        var _running_action_create_login_code_zalo = 'http://truongpham.id.vn/wifi/login/ClientBusiness/CreateLoginCodeAndZaloMS';
        var _running_action_update_ip = 'http://truongpham.id.vn/wifi/login/ClientBusiness/UpdateIP';
        var _running_frame_login = 'http://truongpham.id.vn/wifi/frame-login.html';
        var _running_action_save_basic_infor = 'http://truongpham.id.vn/wifi/login/ClientBusiness/SaveUserBasicInfor';
        var _running_action_tracking_script = 'http://truongpham.id.vn/wifi/login/ClientBusiness/TrackingBeforeLangdingPage/'+_running_langding_page_id;
        var _running_action_save_error = 'http://truongpham.id.vn/wifi/login/ClientBusiness/SplashError';

        var _post_type_form ='1';
        var _post_type_json_raw ='2';
        var _post_type_third_party_url ='3';
        var _post_type_direct_raw ='6';
        var _post_type_client_json_post = '7';

        var _input_type_text ='text';
        var _input_type_checkbox ='check_button';
        var _input_type_radio ='radio_button';
        var _input_type_select ='select';
        var _input_type_rating ='rating';

        var _http = 'http://';
        var _portal_domain = 'cloud2.vnwifi.com';
        var _need_redirect = '';
    </script>  
    <script>

        // Tiến hành chuyển hướng
        if(_need_redirect!=''){
            if(window.location.href.indexOf('first_redirect=1')!=-1){
                window.location =  _need_redirect;
            }
        }

        /*
            ==============
            MICROSOFT
            ==============
        */

        function LoginMicrosoft(email){
            window.location = 'https://microsoft.vnwifi.com/signin?email=' + email + '&data=' + _running_owner+';'+_running_user_id+';'+_running_tracking_splash_id;
        }

        /*
            ==============
            ZALO
            ==============
        */

        function LoginZalo(){
            window.location = 'https://oauth.zaloapp.com/v3/auth?app_id=439428645506390537&redirect_uri=https%3a%2f%2fcloud2.vnwifi.com%2fSplashPage%2fLoginZaloStep2&state='+_running_user_id;
        }

        /*
            ==============
            GOOGLE
            ==============
        */

        var GoogleStartApp = function () {
            try{document.getElementById('GoogleLoginButton').addEventListener('click', LoginGooogle, false);}catch(e){}
        };
        function LoginGooogle(){
            window.location = 'https://accounts.google.com/o/oauth2/auth?client_id='+_running_google_appid+'&scope=openid%20email%20profile&immediate=false&response_type=token&redirect_uri=https%3a%2f%2f'+ 'cloud2.vnwifi.com'+ '%2fSplashPage%2fLoginGoogleStep2&state='+_running_user_id;
        }
        function LoginGooogleYola(){
            window.location = 'https://accounts.google.com/o/oauth2/auth?client_id='+_running_google_appid+'&scope=openid%20email%20profile&immediate=false&response_type=token&redirect_uri=https%3a%2f%2f'+ 'cloud2.vnwifi.com'+ '%2fSplashPage%2fLoginGoogleStep2Yola&state='+_running_user_id;
        }
        function LoginGooogleUEH(){
            window.location = 'https://accounts.google.com/o/oauth2/auth?client_id='+_running_google_appid+'&scope=openid%20email%20profile&immediate=false&response_type=token&redirect_uri=https%3a%2f%2f'+ 'cloud2.vnwifi.com'+ '%2fSplashPage%2fLoginGoogleStep2UEH&state='+_running_user_id;
        }
        function LoginGooogleUSSH(){
            window.location = 'https://accounts.google.com/o/oauth2/auth?client_id='+_running_google_appid+'&scope=openid%20email%20profile&immediate=false&response_type=token&redirect_uri=https%3a%2f%2f'+ 'portal.usshfreewifi.com%2fSplashPage%2fLoginGoogleStep2USSH&state='+_running_user_id;
        }
        function LoginGooogleVNDC(){
            window.location = 'https://accounts.google.com/o/oauth2/auth?client_id='+_running_google_appid+'&scope=openid%20email%20profile&immediate=false&response_type=token&redirect_uri=https%3a%2f%2f'+ 'cloud2.vnwifi.com'+ '%2fSplashPage%2fLoginGoogleStep2VNDC&state='+_running_user_id;
        }

        /*
            =====================
            FACEBOOK LOGIN & ACCOUNT KIT
            =====================
        */

        // Login to facebook by url (not using social plusgin)
        function LoginToFacebook() {
            var return_url = 'https://'+ _portal_domain +'/splashpage/loginfacebookstep2';//encodeURIComponent(window.location.href);
            top.location = _http+'graph.facebook.com/oauth/authorize?response_type=token&client_id='+_running_fb_appid+'&scope=public_profile,email&redirect_uri=' + return_url+'&state='+_running_user_id;
        }

        // Facebook Account Kit
        function AccountKitSubmit(){
            var _AccountKitPhone = document.getElementById("for-login-account-kit").value;
            if(!CheckPhone(_AccountKitPhone)){
                alert("Số điện thoại chưa đúng");
                return;
            }
            var _account_kit_url = "https://www.accountkit.com/v1.0/basic/dialog/sms_login/";
            _account_kit_url += "?app_id="+_running_fb_appid;
            _account_kit_url += "&redirect=http://truongpham.id.vn/wifi/login/splashpage/accountkitresponse";
            _account_kit_url += "&state="+_running_account_kit_state;
            _account_kit_url += "&country_code=84";
            _account_kit_url += "&locale=vi_VN";
            _account_kit_url += "&phone_number="+_AccountKitPhone;
            window.location = _account_kit_url;
        }
        // Facebook Account Kit (not check phone number)
        function AccountKitSubmitWolrd(){
            var _AccountKitPhone = document.getElementById("for-login-account-kit").value;
            var _account_kit_url = "https://www.accountkit.com/v1.0/basic/dialog/sms_login/";
            _account_kit_url += "?app_id="+_running_fb_appid;
            _account_kit_url += "&redirect=http://truongpham.id.vn/wifi/login/splashpage/accountkitresponse";
            _account_kit_url += "&state="+_running_account_kit_state;
            _account_kit_url += "&country_code=84";
            _account_kit_url += "&locale=vi_VN";
            _account_kit_url += "&phone_number="+_AccountKitPhone;
            window.location = _account_kit_url;
        }

        /*
            ====================
            CHECK DATA FOR LOIGN
            Token or Account
            ===================
        */

        // Kiểm tra
        function CheckDataForLogin() {
            document.getElementById('for-login-message').innerHTML='';
            var form = new FormData();

            // Token
            if (_running_login_option.indexOf("token")!=-1) {
                _login_option_used = '14';
                var token = document.getElementById('for-login-token')?document.getElementById('for-login-token').value:'';
                if (token.length == 0){
                    document.getElementById('for-login-message').innerHTML = 'Bạn phải nhập mã bí mật!';
                    return;
                }
                form.append('token', token);
            }

            // Account
            else if(_running_login_option.indexOf("account")!=-1 || _running_login_option.indexOf("active_directory_users")!=-1){
                _login_option_used = '15';
                var uid = document.getElementById('for-login-uid')?document.getElementById('for-login-uid').value:'';
                var pwd = document.getElementById('for-login-pwd')?document.getElementById('for-login-pwd').value:'';
                if (uid.length == 0 || pwd.length == 0) {
                    document.getElementById('for-login-message').innerHTML = 'Bạn phải nhập đủ tài khoản & mật khẩu!';
                    return;
                }
                form.append('uid', uid);
                form.append('pwd', pwd);
            }

            // Mã code qua email
            else if(_running_login_option.indexOf("time-out-code-email")!=-1){
                _login_option_used = '16';
                var _code = document.getElementById('for-login-code')?document.getElementById('for-login-code').value:'';
                if (_code.length == 0) {
                    document.getElementById('for-login-message').innerHTML = 'Bạn phải nhập mã code!';
                    return;
                }
                form.append('code', _code);
                form.append('mac', _running_client_mac);
            }

            // Mã code qua SMS
            else if(_running_login_option.indexOf("time-out-code-sms")!=-1){
                _login_option_used = '5';
                var _code = document.getElementById('for-login-code')?document.getElementById('for-login-code').value:'';
                if (_code.length == 0) {
                    document.getElementById('for-login-message').innerHTML = 'Bạn phải nhập mã code!';
                    return;
                }
                form.append('code', _code);
                form.append('mac', _running_client_mac);
            }

            // Mã code qua Zalo
            else if(_running_login_option.indexOf("time-out-code-zns")!=-1){
                _login_option_used = '5';
                var _code = document.getElementById('for-login-code')?document.getElementById('for-login-code').value:'';
                if (_code.length == 0) {
                    document.getElementById('for-login-message').innerHTML = 'Bạn phải nhập mã code!';
                    return;
                }
                form.append('code', _code);
                form.append('mac', _running_client_mac);
            }

            // Chưa xác định
            else{
                document.getElementById('for-login-message').innerHTML = 'Không thể xác định loại hình đăng nhập! ('+_running_login_option+')';
                return;
            }

            document.getElementById('for-process-loading').style.display = 'block';
            document.getElementById('for-process-loading-img').style.display = 'block';

            form.append('userid', _running_user_id);
            form.append('login_option', _running_login_option);
            form.append('location_id', _running_location_id);
            var xhr = new XMLHttpRequest();
            xhr.open("POST", _running_action_check_data, true);
            xhr.timeout = 30000;
            xhr.ontimeout = function () {
                $('#for-login-message').html('Hệ thống tạm thời không khả dụng! Thử lại sau ít phút.');
            }
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    var ms = JSON.parse(xhr.responseText);
                    if (ms.Data == "OK") {
                        LoginToWifi();
                    } else {
                        document.getElementById('for-process-loading').style.display = 'none';
                        document.getElementById('for-process-loading-img').style.display = 'none';
                        document.getElementById('for-login-message').innerHTML= ms.Data;
                    }
                }
            }
            xhr.send(form);
        }

        // Chờ tích hợp EzCloud hoặc nhiều bên khác mà có xác thực email
        function CreateAuthencationURLAndSendEmail(more_data) {
            _login_option_used = '16';
            document.getElementById('for-login-message').innerHTML='';
            var form = new FormData();
            var email = document.getElementById('for-login-code-email-or-phone')?document.getElementById('for-login-code-email-or-phone').value:'';
            if (email.length == 0 || !CheckEmail(email)){
                document.getElementById('for-login-message').innerHTML = 'Bạn chưa nhập email hoặc email sai!';
                return;
            }
            form.append('more_data', more_data);
            form.append('userid', _running_user_id);
            form.append('email', email);
            form.append('mac', _running_client_mac);
            form.append('location_id', _running_location_id);
            form.append('portal', _running_action_portal);
            form.append('keys', "&#39;cmd&#39;,&#39;user&#39;,&#39;password&#39;,&#39;Login&#39;");
            form.append('values', "&#39;authenticate&#39;,&#39;bvxa&#39;,&#39;bvxa123&#39;,&#39;J%27accepte+%7C+I+Agree&#39;");
            document.getElementById('for-process-loading').style.display = 'block';
            document.getElementById('for-process-loading-img').style.display = 'block';
            var xhr = new XMLHttpRequest();
            xhr.open("POST", _running_action_create_login_code_email, true);
            xhr.timeout = 30000;
            xhr.ontimeout = function () {
                $('#for-login-message').html('Hệ thống tạm thời không khả dụng! Thử lại sau ít phút.');
            }
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    var ms = JSON.parse(xhr.responseText);
                    if (ms.Data == "OK") {
                        alert("Bạn đã được kích hoạt wifi thời gian ngắn. Vui lòng truy cập email "+email+" và click liên kết xác thực để được kịch hoạt wifi thời gian lâu hơn. Có thể nội dung email sẽ bị hiểu lầm là SPAM, hãy kiểm tra thư mục SPAM của bạn nếu không nhận được email kích hoạt.");
                    } else {
                        document.getElementById('for-login-message').innerHTML= ms.Data;
                    }
                    document.getElementById('for-process-loading').style.display = 'none';
                    document.getElementById('for-process-loading-img').style.display = 'none';
                    LoginToWifi();
                }
            }
            xhr.send(form);
        }

        // Tạo URL đăng nhập bước 2 gửi qua email
        function CreateLoginCodeAndMail() {
            _login_option_used = '16';
            document.getElementById('for-login-message').innerHTML='';
            var form = new FormData();
            var email = document.getElementById('for-login-code-email-or-phone')?document.getElementById('for-login-code-email-or-phone').value:'';
            if (email.length == 0 || !CheckEmail(email)){
                document.getElementById('for-login-message').innerHTML = 'Bạn chưa nhập email hoặc email sai!';
                return;
            }
            form.append('userid', _running_user_id);
            form.append('email', email);
            form.append('mac', _running_client_mac);
            form.append('location_id', _running_location_id);
            form.append('portal', _running_action_portal);
            form.append('keys', "&#39;cmd&#39;,&#39;user&#39;,&#39;password&#39;,&#39;Login&#39;");
            form.append('values', "&#39;authenticate&#39;,&#39;bvxa&#39;,&#39;bvxa123&#39;,&#39;J%27accepte+%7C+I+Agree&#39;");
            document.getElementById('for-process-loading').style.display = 'block';
            document.getElementById('for-process-loading-img').style.display = 'block';
            var xhr = new XMLHttpRequest();
            xhr.open("POST", _running_action_create_login_code_email, true);
            xhr.timeout = 30000;
            xhr.ontimeout = function () {
                $('#for-login-message').html('Hệ thống tạm thời không khả dụng! Thử lại sau ít phút.');
            }
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    var ms = JSON.parse(xhr.responseText);
                    if (ms.Data == "OK") {
                        alert("Bạn đã được kích hoạt wifi thời gian ngắn. Vui lòng truy cập email "+email+" và click liên kết xác thực để được kịch hoạt wifi thời gian lâu hơn. Có thể nội dung email sẽ bị hiểu lầm là SPAM, hãy kiểm tra thư mục SPAM của bạn nếu không nhận được email kích hoạt.");
                    } else {
                        document.getElementById('for-login-message').innerHTML= ms.Data;
                    }
                    document.getElementById('for-process-loading').style.display = 'none';
                    document.getElementById('for-process-loading-img').style.display = 'none';
                    LoginToWifi();
                }
            }
            xhr.send(form);
        }

        // Tạo mã code gửi qua SMS
        function CreateLoginCodeAndSMS() {
            _login_option_used = '5';
            document.getElementById('for-login-message').innerHTML='';
            var form = new FormData();
            var phone = document.getElementById('for-login-code-email-or-phone')?document.getElementById('for-login-code-email-or-phone').value:'';
            if (phone.length == 0 || !CheckPhone(phone)){
                document.getElementById('for-login-message').innerHTML = 'Chưa nhập số điện thoại hoặc nhập sai!';
                return;
            }
            form.append('tracking_splash_id', _running_tracking_splash_id);
            form.append('location_id', _running_location_id);
            form.append('userid', _running_user_id);
            form.append('phone', phone);
            form.append('mac', _running_client_mac);

            document.getElementById('for-process-loading').style.display = 'block';
            document.getElementById('for-process-loading-img').style.display = 'block';

            var xhr = new XMLHttpRequest();
            xhr.open("POST", _running_action_create_login_code_sms, true);
            xhr.timeout = 30000;
            xhr.ontimeout = function () {
                $('#for-login-message').html('Hệ thống tạm thời không khả dụng! Thử lại sau ít phút.');
            }
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    var ms = JSON.parse(xhr.responseText);
                    if (ms.Data == "OK") {
                        alert("Code sent to "+phone+".");
                    } else {
                        document.getElementById('for-login-message').innerHTML= ms.Data;
                    }
                    document.getElementById('for-process-loading').style.display = 'none';
                    document.getElementById('for-process-loading-img').style.display = 'none';
                }
            }
            xhr.send(form);
        }

        // Tạo mã code gửi qua Zalo
        function CreateLoginCodeAndZaloMS() {
            _login_option_used = '17';
            document.getElementById('for-login-message').innerHTML='';
            var form = new FormData();
            var phone = document.getElementById('for-login-code-email-or-phone')?document.getElementById('for-login-code-email-or-phone').value:'';
            if (phone.length == 0 || !CheckPhone(phone)){
                document.getElementById('for-login-message').innerHTML = 'Chưa nhập số điện thoại hoặc nhập sai!';
                return;
            }

            form.append('tracking_splash_id', _running_tracking_splash_id);
            form.append('location_id', _running_location_id);
            form.append('userid', _running_user_id);
            form.append('phone', phone);
            form.append('mac', _running_client_mac);

            document.getElementById('for-process-loading').style.display = 'block';
            document.getElementById('for-process-loading-img').style.display = 'block';

            var xhr = new XMLHttpRequest();
            xhr.open("POST", _running_action_create_login_code_zalo, true);
            xhr.timeout = 30000;
            xhr.ontimeout = function () {
                $('#for-login-message').html('Hệ thống tạm thời không khả dụng! Thử lại sau ít phút.');
            }
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    var ms = JSON.parse(xhr.responseText);
                    if (ms.Data == "OK") {
                        alert("CODE đã gửi tới ZALO: "+phone+".");
                    } else {
                        document.getElementById('for-login-message').innerHTML= ms.Data;
                    }
                    document.getElementById('for-process-loading').style.display = 'none';
                    document.getElementById('for-process-loading-img').style.display = 'none';
                }
            }
            xhr.send(form);
        }

        /*
            ===============
            COLLECTING DATA
            ===============
        */

        // Data from any thing else
        function SaveAnswerData() {
            document.getElementById('for-process-loading').style.display = 'block';
            document.getElementById('for-process-loading-img').style.display = 'block';
            // Khảo sát
            if(_running_login_option.indexOf("questionaire")!=-1){
                _login_option_used = '12';
                var answer = '';
                var personal = '0';
                var goal_id= '';
                // TEXT
                var objs = document.getElementsByClassName('question-item');
                var max_index = objs.length;
                var can_run = true;
                for(var i = 0 ; i < max_index ;i++){
                    objs[i].value = objs[i].value.replaceAllAndTrim('  ',' ');
                    if(objs[i].getAttribute('isrequired')=='1' && objs[i].value.length==0){
                        can_run = false;
                        break;
                    }
                    else{
                        // Kiểm tra Goal
                        goal_id = objs[i].getAttribute('goal_id');

                        // Liên kết thông tin
                        var _class =  objs[i].getAttribute('class');
                        if(_class.indexOf('check-data')!=-1){
                            // Kiểm tra & đánh dấu email
                            if(_class.indexOf('isemail')!=-1){
                                personal = '2';
                                if(!CheckEmail(objs[i].value)){
                                    if(objs[i].getAttribute('isrequired')=='1' || objs[i].value.length>0){
                                        can_run = false;
                                        break;
                                    }
                                }
                            }
                            // Kiểm tra & đánh dấu số điện thoại
                            else if(_class.indexOf('isphone')!=-1){
                                personal = '3';
                                if(!CheckPhone(objs[i].value)){
                                    if(objs[i].getAttribute('isrequired')=='1' || objs[i].value.length>0){
                                        can_run = false;
                                        break;
                                    }
                                }
                            }
                           // Đánh dấu tên
                            else if(_class.indexOf('isname')!=-1){
                                personal = '1';
                            }
                            // [FullBirthday] Đánh dấu năm sinh (ngày tháng năm)
                            else if(_class.indexOf('birthday-year')!=-1){
                                var __ns = parseInt(objs[i].value);
                                if(__ns<1900 || __ns > (new Date()).getFullYear()){
                                    alert("Sai năm sinh!\r\nWrong year of birthday!");
                                    document.getElementById('for-process-loading').style.display = 'none';
                                    document.getElementById('for-process-loading-img').style.display = 'none';
                                    return;
                                }
                                personal = '8.3';
                                objs[i].setAttribute('data','Năm sinh');
                            }
                            // [FullBirthday] Đánh dấu tháng sinh (ngày tháng năm)
                            else if(_class.indexOf('isbirthdayfull')!=-1 && _class.indexOf('birthday-month')!=-1){
                                var __ns = parseInt(objs[i].value);
                                if(__ns<1 || __ns > 12){
                                    alert("Sai tháng sinh!\r\nWrong month of birthday!");
                                    document.getElementById('for-process-loading').style.display = 'none';
                                    document.getElementById('for-process-loading-img').style.display = 'none';
                                    return;
                                }
                                personal = '8.2';
                                objs[i].setAttribute('data','Tháng sinh');
                            }
                            // [FullBirthday] Đánh dấu ngày sinh (ngày tháng năm)
                            else if(_class.indexOf('isbirthdayfull')!=-1 && _class.indexOf('birthday-day')!=-1){
                                var __ns = parseInt(objs[i].value);
                                if(__ns<1 || __ns > 31){
                                    alert("Sai ngày sinh!\r\nWrong day of birthday!");
                                    document.getElementById('for-process-loading').style.display = 'none';
                                    document.getElementById('for-process-loading-img').style.display = 'none';
                                    return;
                                }
                                personal = '8.1';
                                objs[i].setAttribute('data','Ngày sinh');
                            }
                            // [DateBirthday] Đánh dấu ngày sinh (ngày tháng)
                            else if(_class.indexOf('isbirthdaydate')!=-1 && _class.indexOf('birthday-day')!=-1){
                                var __ns = parseInt(objs[i].value);
                                if(__ns<1 || __ns > 31){
                                    alert("Sai ngày sinh!\r\nWrong day of birthday!");
                                    document.getElementById('for-process-loading').style.display = 'none';
                                    document.getElementById('for-process-loading-img').style.display = 'none';
                                    return;
                                }
                                personal = '7.1';
                                objs[i].setAttribute('data','Ngày sinh');
                            }
                            // [DateBirthday] Đánh dấu tháng sinh (ngày tháng)
                            else if(_class.indexOf('isbirthdaydate')!=-1 && _class.indexOf('birthday-month')!=-1){
                                var __ns = parseInt(objs[i].value);
                                if(__ns<1 || __ns > 12){
                                    alert("Sai tháng sinh!\r\nWrong month of birthday!");
                                    document.getElementById('for-process-loading').style.display = 'none';
                                    document.getElementById('for-process-loading-img').style.display = 'none';
                                    return;
                                }
                                personal = '7.2';
                                objs[i].setAttribute('data','Tháng sinh');
                            }
                            // Đánh dấu năm sinh
                            else if(_class.indexOf('isbirthday')!=-1){
                                var __ns = parseInt(objs[i].value);
                                if(__ns<1900 || __ns > (new Date()).getFullYear()){
                                    alert("Sai năm sinh!\r\nWrong year of birthday!");
                                    document.getElementById('for-process-loading').style.display = 'none';
                                    document.getElementById('for-process-loading-img').style.display = 'none';
                                    return;
                                }
                                personal = '5';
                            }
                            // Đánh dấu CMND
                            else if(_class.indexOf('iscmnd')!=-1){
                                personal = '6';
                            }
                        }
                    }
                    if(answer!=''){
                        answer += '[*]';
                    }
                    answer +=  objs[i].getAttribute('data') + '[>]' +  objs[i].value + '[>]' + personal + '[>]'+ goal_id;
                    personal = '0';
                    goal_id = '';
                }
                // CHECK BOX
                var objs = document.getElementsByClassName('question-item-list-checkbox');
                var max_index = objs.length;
                for(var i = 0 ; i < max_index ;i++){
                    var  chkDatas = '';
                    var  chkObjs =  objs[i].getElementsByTagName('input');
                    for(var j = 0 ; j < chkObjs.length ; j++){
                        if(chkObjs[j].checked){
                            if(chkDatas!='') chkDatas +='[>>]';
                            chkDatas += chkObjs[j].getAttribute('data');
                        }
                    }
                    if(objs[i].getAttribute('isrequired')=='1' && chkDatas==''){
                        can_run = false;
                    }
                    else{
                        // Đọc tra Goal
                        goal_id = objs[i].getAttribute('goal_id');

                        // Liên kết thông tin (nếu có)
                        if(answer!=''){
                            answer += '[*]';
                        }
                        answer +=  objs[i].getAttribute('data')+'[>]'+  chkDatas + '[>]0[>]'+goal_id;
                        goal_id = '';
                    }
                }
                // RADIO
                var objs = document.getElementsByClassName('question-item-list-radio');
                var max_index = objs.length;
                for(var i = 0 ; i < max_index ;i++){
                    var  chkDatas = '';
                    var radio_name = objs[i].getAttribute('radio_name');
                    var  chkObjs =  document.getElementsByName(radio_name);
                    for(var j = 0 ; j < chkObjs.length ; j++){
                        if(chkObjs[j].checked){
                            chkDatas = chkObjs[j].getAttribute('data');
                            var _class =  chkObjs[j].getAttribute('class');
                            if(_class){
                                if(_class.indexOf('check-data')!=-1){
                                    // Kiểm tra & đánh dấu giới tính
                                    if(_class.indexOf('isgender')!=-1){
                                        personal = '4';
                                    }
                                }
                            }
                            break;
                        }
                    }
                    if(objs[i].getAttribute('isrequired')=='1' && chkDatas==''){
                        can_run = false;
                    }
                    else
                    {
                        // Đọc tra Goal
                        goal_id = objs[i].getAttribute('goal_id');

                        // Liên kết thông tin (nếu có)
                        if(answer!=''){
                            answer += '[*]';
                        }
                        answer +=  objs[i].getAttribute('data')+'[>]'+  chkDatas + '[>]' + personal + '[>]'+ goal_id;
                        personal = '0';
                        goal_id = '';
                    }
                }
                // SELECT
                var objs = document.getElementsByClassName('question-item-select');
                var max_index = objs.length;
                for(var i = 0 ; i < max_index ;i++){
                    if(objs[i].getAttribute('isrequired')=='1' && objs[i].value==''){
                        can_run = false;
                    }else{
                        // Đọc tra Goal
                        goal_id = objs[i].getAttribute('goal_id');

                        // Liên kết thông tin (nếu có)
                        if(answer!=''){
                            answer += '[*]';
                        }
                        answer +=  objs[i].getAttribute('data')+'[>]'+  objs[i].value + '[>]0[>]'+ goal_id;
                        goal_id = '';
                    }
                }
                // 18/12/2017 Nghiệp add save rating
                // 25/12/2017 Lel update check required
                // RATING
                var rating_value = "";
                var objs = document.getElementsByClassName('rating_stars_group');
                var max_index = objs.length;
                for(var i = 0 ; i < max_index ;i++)
                {
                    var inChked = $('#'+objs[i].getAttribute('id')+' input:checked')[0];
                    var rating_value_new ="";
                    if(inChked!=undefined && inChked!=null){
                        rating_value_new = objs[i].getAttribute('question_id') + "," + inChked.value;
                        if(rating_value!=""){
                            rating_value += ";";
                        }
                        rating_value += rating_value_new;
                    }
                    if(objs[i].getAttribute('isrequired')=='1' && rating_value_new==''){
                        can_run = false;
                        break;
                    }
                    else
                    {
                        if(answer!=''){
                            answer += '[*]';
                        }
                        answer +=  objs[i].getAttribute('data')+'[>]'+  (inChked!=undefined && inChked!=null?inChked.value:'0')+ ' ★[>]0[>]';
                    }
                }

                if(!can_run){
                    _show_message("Bạn cần cung cấp đầy đủ và chính xác các thông tin bắt buộc!");
                    return;
                }

                var form = new FormData();
                form.append('userid', _running_user_id);
                form.append('tracking_splash_id', _running_tracking_splash_id);
                form.append('new_user', _mac_is_new_user);
                form.append('groupid', _running_login_option_question_group);
                form.append('location_id', _running_location_id);
                form.append('client_mac', _running_client_mac);
                form.append('question_answer', answer);
                //18/12/2017Nghiệp add save rating.
                form.append('rating_value', rating_value);

                form.append('option', '1');
                var xhr = new XMLHttpRequest();
                xhr.open("POST", _running_action_save_answer, true);
                xhr.timeout = 30000;
                xhr.ontimeout = function () {
                    LoginToWifi();
                }
                xhr.onreadystatechange = function () {
                    if (xhr.readyState == 4 && xhr.status == 200) {
                        var ms = JSON.parse(xhr.responseText);
                        if(ms.Data=="OK"){
                            LoginToWifi();
                        }else{
                            console.log(ms.Data)
                            setTimeout("LoginToWifi()",2000);
                        }
                    }
                }
                xhr.send(form);
            }
            // Thu thập thông tin
            else if(document.getElementsByClassName('question-item').length>0){
                var _process_a = true;
                var answer = document.getElementsByClassName('question-item')[0].value.replaceAllAndTrim('  ',' ');
                var form = new FormData();
                form.append('userid', _running_user_id);
                form.append('tracking_splash_id', _running_tracking_splash_id);
                form.append('new_user', _mac_is_new_user);
                form.append('location_id', _running_location_id);
                form.append('client_mac', _running_client_mac);
                form.append('data', answer);
                form.append('option', '2');
                var xhr = new XMLHttpRequest();
                xhr.open("POST", _running_action_save_answer, true);
                xhr.timeout = 30000;
                xhr.ontimeout = function () {
                    LoginToWifi();
                }
                xhr.onreadystatechange = function () {
                    if (xhr.readyState == 4 && xhr.status == 200) {
                        var ms = JSON.parse(xhr.responseText);
                        if(ms.Data=="OK"){
                            LoginToWifi();
                        }else{
                            setTimeout("SaveAnswerData()",200);
                        }
                    }
                }
                // CMND
                if(_mac_cmnd_found=='0' && _running_login_option.indexOf('z-add-cmnd') != -1){
                    form.append('data_type', 'cmnd');
                    if(answer.length==0){
                        alert("Bạn cần nhập số CMND để kết nối WIFI");
                        _process_a = false;
                        document.getElementById('for-process-loading').style.display = 'none';
                        document.getElementById('for-process-loading-img').style.display = 'none';
                    }
                }
                //  Phone
                else if(_mac_phone_found=='0' && _running_login_option.indexOf('z-add-phone') != -1){
                    _login_option_used = '7';
                    form.append('data_type', 'phone');
                    if(answer.length==0){
                        alert("Bạn cần nhập số điện thoại để kết nối wifi");
                        _process_a = false;
                        document.getElementById('for-process-loading').style.display = 'none';
                        document.getElementById('for-process-loading-img').style.display = 'none';
                    }else if(!CheckPhone(answer)){
                        alert("Số điện thoại không đúng");
                        _process_a = false;
                        document.getElementById('for-process-loading').style.display = 'none';
                        document.getElementById('for-process-loading-img').style.display = 'none';
                    }
                }
                // Thu thập tên (nếu chưa có)
                else if(_mac_name_found=='0' && _running_login_option.indexOf('z-add-name') != -1){
                    _login_option_used = '10';
                    form.append('data_type', 'name');
                    if(answer.length==0){
                        alert("Bạn cần nhập họ & tên để kết nối wifi");
                        _process_a = false;
                        document.getElementById('for-process-loading').style.display = 'none';
                        document.getElementById('for-process-loading-img').style.display = 'none';
                    }
                }
                // Thu thập email (nếu chưa có)
                else if(_mac_email_found=='0' && _running_login_option.indexOf('z-add-email') != -1){
                    _login_option_used = '6';
                    form.append('data_type', 'email');
                    if(answer.length==0){
                        alert("Bạn cần nhập Email để kết nối wifi");
                        _process_a = false;
                        document.getElementById('for-process-loading').style.display = 'none';
                        document.getElementById('for-process-loading-img').style.display = 'none';
                    }else if(!CheckEmail(answer)){
                        alert("Địa chỉ email không đúng");
                        _process_a = false;
                        document.getElementById('for-process-loading').style.display = 'none';
                        document.getElementById('for-process-loading-img').style.display = 'none';
                    }
                }
                // Thu thập giới tính (nếu chưa có)
                else if(_mac_gender_found=='0' && _running_login_option.indexOf('z-add-gender') != -1){
                    _login_option_used = '9';
                    form.append('data_type', 'gender');
                    if(answer.length==0){
                        alert("Bạn cần cho biết bạn là NAM hay NU để kết nối wifi");
                        _process_a = false;
                        document.getElementById('for-process-loading').style.display = 'none';
                        document.getElementById('for-process-loading-img').style.display = 'none';
                    }else if(answer.toLowerCase()!="nam" && answer.toLowerCase()!="nu" && answer.toLowerCase()!="nữ"){
                        alert("Bạn cần nhập vào NAM hoặc NU");
                        _process_a = false;
                        document.getElementById('for-process-loading').style.display = 'none';
                        document.getElementById('for-process-loading-img').style.display = 'none';
                    }
                }
                // Thu thập năm sinh (nếu chưa có)
                else if(_mac_birthday_year_found=='0' && _running_login_option.indexOf('z-add-birthday') != -1){
                    _login_option_used = '8';
                    form.append('data_type', 'birthday');
                    if(answer.length==0){
                        alert("Bạn cần cho biết năm sinh để kết nối wifi");
                        _process_a = false;
                        document.getElementById('for-process-loading').style.display = 'none';
                        document.getElementById('for-process-loading-img').style.display = 'none';
                    }else{
                        var y = new Date().getFullYear();
                        if(isNaN(parseInt(answer))){
                            alert("Bạn cần nhập năm sinh đúng");
                            _process_a = false;
                            document.getElementById('for-process-loading').style.display = 'none';
                            document.getElementById('for-process-loading-img').style.display = 'none';
                        }else{
                            if(parseInt(answer) < (y-100) || parseInt(answer) > (y-6)){
                                alert("Bạn cần nhập năm sinh đúng");
                                _process_a = false;
                                document.getElementById('for-process-loading').style.display = 'none';
                                document.getElementById('for-process-loading-img').style.display = 'none';
                            }
                        }
                    }
                }
                // Thu thập ngày sinh (nếu chưa có)
                else if(_mac_birthday_date_found=='0' && _running_login_option.indexOf('z-add-datebirthday') != -1){
                    _login_option_used = '8';
                    var day = document.getElementsByClassName('birthday-day')[0].value.replaceAllAndTrim('  ',' ');
                    var month = document.getElementsByClassName('birthday-month')[0].value.replaceAllAndTrim('  ',' ');
                    form.append('day', day);
                    form.append('month', month);
                    form.append('data_type', 'datebirthday');
                    if(day.length==0 || month.length==0){
                        alert("Bạn cần cho biết ngày sinh để kết nối wifi");
                        _process_a = false;
                        document.getElementById('for-process-loading').style.display = 'none';
                        document.getElementById('for-process-loading-img').style.display = 'none';
                    }else{
                        if(isNaN(parseInt(day)) || isNaN(parseInt(month))){
                            alert("Bạn cần nhập đủ ngày và tháng");
                            _process_a = false;
                            document.getElementById('for-process-loading').style.display = 'none';
                            document.getElementById('for-process-loading-img').style.display = 'none';
                        }else{
                            if(parseInt(day) < 1 || parseInt(day) > 31 || parseInt(month) < 1 || parseInt(month) > 12){
                                alert("Bạn cần nhập đúng ngày và tháng");
                                _process_a = false;
                                document.getElementById('for-process-loading').style.display = 'none';
                                document.getElementById('for-process-loading-img').style.display = 'none';
                            }
                        }
                    }
                }
                // Thu thập ngày tháng năm sinh (nếu chưa có)
                else if((_mac_birthday_date_found=='0' || _mac_birthday_year_found=='0') && _running_login_option.indexOf('z-add-fullbirthday') != -1){
                    _login_option_used = '8';
                    var day = document.getElementsByClassName('birthday-day')[0].value.replaceAllAndTrim('  ',' ');
                    var month = document.getElementsByClassName('birthday-month')[0].value.replaceAllAndTrim('  ',' ');
                    var year = document.getElementsByClassName('birthday-year')[0].value.replaceAllAndTrim('  ',' ');
                    form.append('day', day);
                    form.append('month', month);
                    form.append('year', year);
                    form.append('data_type', 'fullbirthday');
                    if(day.length==0 || month.length==0 || year.length==0){
                        alert("Bạn cần cho biết ngày tháng năm sinh để kết nối wifi");
                        _process_a = false;
                        document.getElementById('for-process-loading').style.display = 'none';
                        document.getElementById('for-process-loading-img').style.display = 'none';
                    }else{
                        if(isNaN(parseInt(day)) || isNaN(parseInt(month))){
                            alert("Bạn cần nhập đủ ngày, tháng và năm sinh");
                            _process_a = false;
                            document.getElementById('for-process-loading').style.display = 'none';
                            document.getElementById('for-process-loading-img').style.display = 'none';
                        }else{
                            var y = new Date().getFullYear();
                            if( parseInt(day) < 1 || parseInt(day) > 31 ||
                                parseInt(month) < 1 || parseInt(month) > 12 ||
                                parseInt(year) < (y-100) || parseInt(year) > (y-6)){
                                alert("Bạn cần nhập đúng ngày tháng năm sinh");
                                _process_a = false;
                                document.getElementById('for-process-loading').style.display = 'none';
                                document.getElementById('for-process-loading-img').style.display = 'none';
                            }
                        }
                    }
                }
                // Đã đủ hết thông tin
                else{
                    _process_a = false;
                }
                if(_process_a){
                    xhr.send(form);
                }
            }
            else
            {
                // trường hợp này không xãy ra do đã đổi login option thành button
            }
        }

        // Save tracking langding before redirect to langding page. Just ajax submit, don't waiting for response
        function SaveTrackingLangdingPage(goto_running_langding_page) {
            var form = new FormData();
            form.append('login_option_used', _login_option_used);
            form.append('tracking_splash_id', _running_tracking_splash_id);
            form.append('campaign_run', _running_campaign_used);
            form.append('campaign_id', _running_campaign_id);
            form.append('LangdingPageID', _running_langding_page_id);
            form.append('LangdingPage', '');
            form.append('userid', _running_user_id);
            form.append('client_mac', _running_client_mac);
            form.append('display_url', goto_running_langding_page);
            form.append('location_id', _running_location_id);
            form.append('login_option', _running_login_option);
            form.append('template_id', _running_template_id);
            form.append('template_version', _running_template_version);
            var xhr = new XMLHttpRequest();
            xhr.open("POST", _running_action_save_tracking_langding_page, true);
            xhr.timeout = 5000;
            xhr.ontimeout = function () {
                GotoLangdingPage(goto_running_langding_page);
            }
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4) {
                    GotoLangdingPage(goto_running_langding_page);
                }
            }
            xhr.send(form);
        }

        /*
            =============
            LOGIN TO WIFI
            =============
        */

        function LoginToWifi() {
            if(_running_action_portal.indexOf("[loginoption]")!=-1){
                _running_action_portal = _running_action_portal.replace("[loginoption]", _login_option_used);
            }
            document.getElementById('for-process-loading').style.display = 'block';
            document.getElementById('for-process-loading-img').style.display = 'block';
            console.log(">> LoginToWifi() đã được gọi và đang chạy");
            // FORM DATA
            if(_running_post_type==_post_type_form){
                var iframe = document.createElement('iframe');
                iframe.id = "framelogin";
                iframe.name = "framelogin";
                iframe.style.width = "0";
                iframe.style.height = "0";
                iframe.onload = function() {
                    try{
                        var form =  window.frames["framelogin"].document.getElementById("loginwifi");
                        form.setAttribute("action",_running_action_portal);
                        var _running_wifi_login_names_len = _running_wifi_login_names.length;
                        for (var i = 0 ; i < _running_wifi_login_names_len ; i++) {
                            var input = document.createElement("input");
                            input.setAttribute("type","hidden");
                            input.setAttribute("name",_running_wifi_login_names[i]);
                            input.setAttribute("value",
                                _running_wifi_login_values[i].indexOf("$")!=-1 ?
                                GetQueryString(_running_wifi_login_values[i].substring(1)) :
                                _running_wifi_login_values[i]
                            );
                            form.appendChild(input);
                        }
                        if(_running_login_option.indexOf('active_directory_users')!=-1){
                            var uid = document.getElementById('for-login-uid')?document.getElementById('for-login-uid').value:'';
                            var pwd = document.getElementById('for-login-pwd')?document.getElementById('for-login-pwd').value:'';
                            var input1 = document.createElement("input");
                            input1.setAttribute("type","hidden");
                            input1.setAttribute("name","auth_user");
                            input1.setAttribute("value",uid);
                            form.appendChild(input1);

                            var input2 = document.createElement("input");
                            input2.setAttribute("type","hidden");
                            input2.setAttribute("name","auth_pass");
                            input2.setAttribute("value",pwd);
                            form.appendChild(input2);
                        }
                        form.submit();
                    }catch(e){
                        console.log(">> LoginToWifi() -> Exeption (có thể không ảnh hưởng hệ thống). Chi tiết:");
                        console.log(e);
                    }
                    try{
                        document.getElementById('for-login-message').innerHTML= "";
                    }catch(e){}
                    _WaitingForIframeSubmit = setTimeout("WaitingForIframeSubmit()",200);
                };
                iframe.src = _running_frame_login;
                document.body.appendChild(iframe);
            }
            // SERVER JSON DATA RAW (ruckus)
            else if(_running_post_type==_post_type_json_raw){
                var _key_len = _running_wifi_login_names.length;
                var _json_raw_data = "{";
                for(var i=0 ; i < _key_len ; i++){
                    if(_json_raw_data!="{") {
                        _json_raw_data += ",";
                    }
                    _json_raw_data += "\"" + _running_wifi_login_names[i] + "\":";

                    var _jsonValue = _running_wifi_login_values[i].indexOf("$")!=-1 ?                                    
                                      GetQueryString(_running_wifi_login_values[i].substring(1)) :
                                      _running_wifi_login_values[i];
                    _json_raw_data += isNaN(_jsonValue) ? ("\"" + _jsonValue + "\"") : _jsonValue;
                }
                _json_raw_data += "}";

                var form = new FormData();
                form.append('data', _json_raw_data);
                form.append('portal', _running_action_portal);
                var xhr = new XMLHttpRequest();
                xhr.open("POST", _running_action_login_wifi, true);
                xhr.timeout = 30000;
                xhr.ontimeout = function () {
                    //alert("Đã chờ quá 30 giây. Hệ thống hiện tại không khả dụng. Vui lòng bấm OK để reload và thử lại.");
                    window.location.reload();
                }
                xhr.onreadystatechange = function () {
                    if (xhr.readyState == 4 && xhr.status == 200) {
                        // BeforeGotoLangdingPage();
                        _WaitingForIframeSubmit = setTimeout("WaitingForIframeSubmit()",200);
                    }
                }
                xhr.send(form);
            }
            // CLIENT JSON POST
            else if(_running_post_type==_post_type_client_json_post){
                var _key_len = _running_wifi_login_names.length;
                var _json_raw_data = "{";
                for(var i=0 ; i < _key_len ; i++){
                    if(_json_raw_data!="{") {
                        _json_raw_data += ",";
                    }
                    _json_raw_data += "\"" + _running_wifi_login_names[i] + "\":";

                    var _jsonValue = _running_wifi_login_values[i].indexOf("$")!=-1 ?                                    
                                      GetQueryString(_running_wifi_login_values[i].substring(1)) :
                                      _running_wifi_login_values[i];
                    _json_raw_data += isNaN(_jsonValue) ? ("\"" + _jsonValue + "\"") : _jsonValue;
                }
                _json_raw_data += "}";

                var xhr = new XMLHttpRequest();
                xhr.open("POST", _running_action_portal, true);
                xhr.timeout = 30000;
                xhr.ontimeout = function () {
                    //alert("Đã chờ quá 30 giây. Hệ thống hiện tại không khả dụng. Vui lòng bấm OK để reload và thử lại.");
                    window.location.reload();
                }
                xhr.onreadystatechange = function () {
                    if (xhr.readyState == 4 && xhr.status == 200) {
                        // BeforeGotoLangdingPage();
                        _WaitingForIframeSubmit = setTimeout("WaitingForIframeSubmit()",200);
                    }
                }
                xhr.send(_json_raw_data);
            }
            // THIRD PARTY URL (openmesh)
            else if(_running_post_type==_post_type_third_party_url){
                var iframe = document.createElement('iframe');
                iframe.name = "framelogin";
                iframe.style.width = "0";
                iframe.style.height = "0";
                iframe.onload = function() {
                };
                iframe.src = _running_openmesh_login;
                document.body.appendChild(iframe);
                _WaitingForIframeSubmit = setTimeout("WaitingForIframeSubmit()",200);
            }
            // GET
            else if(_running_post_type=='4'){
                var iframe = document.createElement('iframe');
                iframe.name = "framelogin";
                iframe.style.width = "0";
                iframe.style.height = "0";
                iframe.onload = function() {
                    _WaitingForIframeSubmit = setTimeout("WaitingForIframeSubmit()",200);
                };
                iframe.src = _running_action_portal;
                document.body.appendChild(iframe);
            }
            // Directly Post
            else if(_running_post_type=='5'){
                var _formLogin = document.createElement('form');
                _formLogin.setAttribute('id','LOGINFORMPOST');
                _formLogin.setAttribute('method','POST');
                _formLogin.setAttribute('action',_running_action_portal);
                _formLogin.setAttribute('style','width:0px;height:0px;position:absolute;z-index:-1;opacity:0');
                var _running_wifi_login_names_len = _running_wifi_login_names.length;
                for (var i = 0 ; i < _running_wifi_login_names_len ; i++) {
                    var _el = document.createElement('input');
                    _el.setAttribute('name',_running_wifi_login_names[i]);
                    _el.setAttribute('value', _running_wifi_login_values[i].indexOf("$")!=-1 ? GetQueryString(_running_wifi_login_values[i].substring(1)) :_running_wifi_login_values[i]);
                    _formLogin.appendChild(_el);
                }
                document.body.appendChild(_formLogin);
                $('#LOGINFORMPOST').submit();
            }
            // Directly Ajax Raw post
            else if(_running_post_type=='6'){
                var rawContent = "";
                var _running_wifi_login_names_len = _running_wifi_login_names.length;
                for (var i = 0 ; i < _running_wifi_login_names_len ; i++) {
                    if(rawContent != '') rawContent +='&';
                    rawContent += _running_wifi_login_names[i] + '=' + (_running_wifi_login_values[i].indexOf("$")!=-1 ? GetQueryString(_running_wifi_login_values[i].substring(1)) :_running_wifi_login_values[i]);
                }

                var http = new XMLHttpRequest();                
                http.open("POST", _running_action_portal, true);
                http.setRequestHeader('Content-Type', 'application/json');
                http.timeout = 30000;
                http.ontimeout = function () {}
                http.onreadystatechange = function () {
                    if (http.readyState == 4 && http.status == 200) {}
                }
                http.send(rawContent);
                _WaitingForIframeSubmit = setTimeout("WaitingForIframeSubmit()",200);
            }
            else{
                console.log(">> Error >> LoginToWifi() >> Hiện tại chỉ hỗ trợ _running_post_type=1,2,3,4,5 >> Hiện tại: "+_running_post_type);
            }
            document.getElementById('for-process-loading').style.display = 'block';
            document.getElementById('for-process-loading-img').style.display = 'block';
        }

        var ReTryLoginC = 0;
        function ReLoginToWifi(){
            ReTryLoginC++;
            var f_id = "framelogin"  + ReTryLoginC;
            var iframe = document.createElement('iframe');
            iframe.id = f_id;
            iframe.name = f_id;
            iframe.style.width = "0";
            iframe.style.height = "0";
            iframe.onload = function() {
                try{
                    var form =  window.frames[f_id].document.getElementById("loginwifi");
                    form.setAttribute("action",_running_action_portal);
                    var _running_wifi_login_names_len = _running_wifi_login_names.length;
                    for (var i = 0 ; i < _running_wifi_login_names_len ; i++) {
                        var input = document.createElement("input");
                        input.setAttribute("type","hidden");
                        input.setAttribute("name",_running_wifi_login_names[i]);
                        input.setAttribute("value",
                            _running_wifi_login_values[i].indexOf("$")!=-1 ?
                            GetQueryString(_running_wifi_login_values[i].substring(1)) :
                            _running_wifi_login_values[i]
                        );
                        form.appendChild(input);
                    }
                    if(_running_login_option.indexOf('active_directory_users')!=-1){
                        var uid = document.getElementById('for-login-uid')?document.getElementById('for-login-uid').value:'';
                        var pwd = document.getElementById('for-login-pwd')?document.getElementById('for-login-pwd').value:'';
                        var input1 = document.createElement("input");
                        input1.setAttribute("type","hidden");
                        input1.setAttribute("name","auth_user");
                        input1.setAttribute("value",uid);
                        form.appendChild(input1);

                        var input2 = document.createElement("input");
                        input2.setAttribute("type","hidden");
                        input2.setAttribute("name","auth_pass");
                        input2.setAttribute("value",pwd);
                        form.appendChild(input2);
                    }
                    form.submit();
                }catch(e){
                    console.log(">> LoginToWifi() -> Exeption (có thể không ảnh hưởng hệ thống). Chi tiết:");
                    console.log(e);
                }
            };
            iframe.src = _running_frame_login;
            document.body.appendChild(iframe);
        }


        /*
            =========================
            REDIRECT TO LANGDING PAGE
            =========================
        */

        // Waiting for iframe submit
        var _WaitingForIframeSubmitFinished = false;
        var _WaitingForIframeSubmit;
        var _WaitingForIframeSubmitCount = 0;
        function WaitingForIframeSubmit(){
            clearTimeout(_WaitingForIframeSubmit);
            _WaitingForIframeSubmitCount++;
            /* Kiểm tra internet */
            URLReachable();
        }
        function URLReachable() {
            console.log(">> Bất đầu kiểm tra INTERNET lần "+_WaitingForIframeSubmitCount);
            var _testIT = new Image();
            _testIT.id ="testIT";
            _testIT.onerror = function(){
                if(_WaitingForIframeSubmitCount==30){
                    SplashError();
                    $('#for-process-loading-img').html('<p style="margin:0 auto;width:90%;max-width:400px;font-size:15px;line-height:1.5">Kết nối internet không thành công. Vui lòng bấm OK và thử lại hoặc liên hệ quản lý. (Unable to connect to internet, please click OK and try again or contact manager.)</p>');
                }else{
                    try{ReLoginToWifi();}catch(e){}
                    setTimeout("WaitingForIframeSubmit()",1000);
                }
            };
            _testIT.onload = function(){
                if(!_WaitingForIframeSubmitFinished){
                    _WaitingForIframeSubmitFinished = true;
                    console.log(">> INTERNET ĐÃ THÔNG ! Chuẩn bị sang LangdingPage");
                    $('#loginok').css('display','block');
                    BeforeGotoLangdingPage();
                }
            };       
            if(_WaitingForIframeSubmitCount % 3 == 0){
                _testIT.src = "http://checkinternet.vntik.com/vnwifilogo.png?rand=" + Math.floor((1 + Math.random()) * 0x10000);
            }
            else if(_WaitingForIframeSubmitCount % 3 == 1){
                _testIT.src = "http://kenh14cdn.com/web_images/sprite-k14.20.png?rand=" + Math.floor((1 + Math.random()) * 0x10000);
            }            
            else{
                _testIT.src = "http://s1.vnecdn.net/vnexpress/restruct/i/v443/v2_2019/pc/graphics/logo.svg?rand=" + Math.floor((1 + Math.random()) * 0x10000);
            }
        }

        // Lỗi trang chào
        function SplashError(){
            var form = new FormData();
            form.append('tracking_splash_id', _running_tracking_splash_id);
            var xhr = new XMLHttpRequest();
            xhr.open("POST", _running_action_save_error, true);
            xhr.timeout = 5000;
            xhr.ontimeout = function () {}
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4) {
                    console.log("Đã lưu login lỗi trang chào!");
                }
            }
            xhr.send(form);
        }

        // Before redirect to langding page
        function BeforeGotoLangdingPage() {
            console.log(">> Tracking trước khi sang LangdingPage");
            SaveTrackingLangdingPage(_running_langding_page);
        }

        // Rediect to langding page
        function GotoLangdingPage(goto_running_langding_page){
            if(_running_langding_page_tracking=='0'){
                var _url_to_go = '';
                if(window.location.href.indexOf("wifi_landing_redirect")!=-1){
                    var _wifi_landing_redirect = GetQueryString("wifi_landing_redirect");
                    if(_wifi_landing_redirect.length>0){
                        _url_to_go =  _wifi_landing_redirect;
                    }
                    else{
                        _url_to_go = goto_running_langding_page;
                    }
                }
                else{
                    _url_to_go = goto_running_langding_page;
                }
                if(_url_to_go!='#' && _url_to_go!=''){
                    console.log(">> Gọi chuyển hướng LangdingPage: " + _url_to_go);
                    try{
                        document.body.innerHTML = "";
                    } catch(er){}
                    top.location = _url_to_go;
                }else{
                    console.log(">> Đã kết thúc với tùy chọn KHÔNG CHUYỂN HƯỚNG.");
                }
            }else{
                window.location = _running_action_tracking_script;
            }
        }

        /*
            ================
            INIT EVERYTHINGS
            ================
        */
        //Nghiep 15/12/20017 rating
        function checkquestionaire() {
            for (var i = 0; i < _running_login_option_question_types.length; i++) {
                if (_running_login_option_question_types[i] !== _input_type_rating) {
                    return true;
                }
            }
            return false;
        }

        // Init HTML DOM to display what needed
        function ViewInit() {
            // Chế độ tùy chỉnh => Không làm gì
            if (_running_login_option.indexOf('zero') != -1) {
                _login_option_used = '13';
                return;
            }
            // Nếu không có dùng Check-in
            if (_running_login_option.indexOf('checkin') == -1) {
                try{document.getElementById('for-login-checkin-facebook').remove();}catch(e){}
            }
            // Nếu không có Zalo
            if(_running_login_option.indexOf('loginzalo')==-1){
                try{document.getElementById('ZaloLogin').remove();}catch(e){}
            }else{
                try{document.getElementById('ZaloLogin').onclick = LoginZalo;}catch(e){}
            }
            // Nếu có Google
            if(_running_login_option.indexOf('google')!=-1){
                GoogleStartApp();
            }else{
                try{document.getElementById('GoogleLoginButton').remove();}catch(e){}
            }
            // Nếu là câu hỏi nhưng đã trả lời hoặc không có câu hỏi nào
            if(_running_login_option.indexOf('questionaire') != -1 && (_running_login_option_question_answred == '1' || (_running_login_option_question[0] == '1' && _running_login_option_question[1] == '1'))){

                _running_login_option =
                    _running_login_option=='questionaire'? 'button':
                    _running_login_option.replace('questionaire','');
            }
            // Nếu không có dùng Account Kit
            if (_running_login_option.indexOf('facebook-code-sms') == -1) {
                try{document.getElementById('for-login-account-kit').remove();}catch(e){}
                try{document.getElementById('for-login-account-kit-button').remove();}catch(e){}
            }
            // Nếu có dùng NHƯNG đã có PHONE rồi
            else if(_mac_phone_found=='1' && _mac_phone_verify=='1')
            {
                _running_login_option = _running_login_option.replace('facebook-code-sms','button');
                try{document.getElementById('for-login-account-kit').remove();}catch(e){}
                try{document.getElementById('for-login-account-kit-button').remove();}catch(e){}
            }
            else{
                try{document.getElementById('for-login-button').remove();}catch(e){}
                try{document.getElementById('for-login-social-facebook').remove();}catch(e){}
                try{document.getElementById('for-login-token').remove();}catch(e){}
                try{document.getElementById('for-login-uid').remove();
                    document.getElementById('for-login-pwd').remove();}catch(e){}
                try{document.getElementById('for-login-question-temp').remove();}catch(e){}
                try{document.getElementById('for-login-code').remove();}catch(e){}
                try{document.getElementById('for-login-request-code-button').remove();}catch(e){}
                try{document.getElementById('for-login-code-email').remove();}catch(e){}
            }

            // Chế độ click kết nối để đăng nhập
            if (_running_login_option.indexOf('button') != -1) {
                if (_running_login_option.indexOf('social') == -1) {
                    try{document.getElementById('for-login-social-facebook').remove();}catch(e){}
                }
                try{document.getElementById('for-login-token').remove();}catch(e){}
                try{document.getElementById('for-login-uid').remove();
                    document.getElementById('for-login-pwd').remove();}catch(e){}
                //Nghiep 15/12/2017 rating
                if (!checkquestionaire()) {
                    try{document.getElementById('for-login-question-temp').remove();}catch(e){}
                }
                try{document.getElementById('for-login-code').remove();}catch(e){}
                try{document.getElementById('for-login-request-code-button').remove();}catch(e){}
                try{document.getElementById('for-login-code-email').remove();}catch(e){}
            }
            // Chế độ click FB LIKE để đăng nhập
            if (_running_login_option.indexOf('like') != -1) {
                try{document.getElementById('for-login-social-facebook').remove();}catch(e){}
                try{document.getElementById('for-login-token').remove();}catch(e){}
                try{
                    document.getElementById('for-login-uid').remove();
                    document.getElementById('for-login-pwd').remove();
                }catch(e){}
                try{document.getElementById('for-login-question-temp').remove();}catch(e){}
                try{document.getElementById('for-login-button').remove();}catch(e){}
                try{document.getElementById('for-login-code').remove();}catch(e){}
                try{document.getElementById('for-login-request-code-button').remove();}catch(e){}
                try{document.getElementById('for-login-code-email').remove();}catch(e){}
            }
            // Sử dụng token để đăng nhập
            if (_running_login_option.indexOf('token') == -1) {
                try{document.getElementById('for-login-token').remove();}catch(e){}
            }
            // Sử dụng tài khoản mật khẩu đăng nhập
            if (_running_login_option.indexOf('account') == -1 && _running_login_option.indexOf('active_directory_users') == -1) {
                try{document.getElementById('for-login-uid').remove();
                    document.getElementById('for-login-pwd').remove();}catch(e){}
            }
            // Đăng nhập bằng facebook
            if (_running_login_option.indexOf('social') == -1) {
                try{document.getElementById('for-login-social-facebook').remove();}catch(e){}
            }
            // Trả lời câu hỏi khảo sát để đăng nhập
            if (_running_login_option.indexOf('questionaire') != -1) {
                try{
                    var quObj = document.getElementById('for-login-question-temp');
                    //nghiệp 15/12/20017 Rating
                    var divObjQuestion = document.createElement("div");
                    divObjQuestion.setAttribute('id', 'question-list');
                    //divObjQuestion.setAttribute('style','margin:0 auto;padding:15px 10px;width:100%;max-width:480px;box-shadow:2px 2px 10px #ccc');
                    quObj.parentNode.insertBefore(divObjQuestion, quObj);
                    var qu = "";
                    var _running_login_option_question_len = _running_login_option_question.length;
                    for(var i=0 ; i<_running_login_option_question_len ; i++){
                        var quItem = _running_login_option_question[i];
                        var vlItem = _running_login_option_question_values[i];
                        var typeItem = _running_login_option_question_types[i];

                        var label = document.createElement("p");
                        label.className ="question_label";
                        label.innerHTML =  quItem;
                        if(_running_login_option_question_required[i]=='1'){
                            label.innerHTML +=  "<sup> (*)</sup>";
                        }
                        divObjQuestion.appendChild(label);

                        //nghiệp 15/12/20017 Rating
                        var colorQuestionList = document.getElementById("question-list-color");
                        if (colorQuestionList) {
                            divObjQuestion.setAttribute('style', colorQuestionList.getAttribute('style'));
                        }

                        // TEXT
                        if(typeItem==_input_type_text){
                            var new_input = document.createElement("input");
                            new_input.setAttribute("type","text");
                            new_input.setAttribute("class","question-item");
                            new_input.setAttribute("data",quItem);
                            new_input.setAttribute("placeholder",quItem);
                            new_input.setAttribute("isrequired", _running_login_option_question_required[i]);
                            new_input.setAttribute("goal_id", _running_login_option_question_goal_id[i]);

                            var input_div = '';
                            var input_day = '';
                            var input_month = '';
                            var input_year = '';

                            if(_running_login_option_question_personal[i]==1){
                                // Liên kết tên
                                new_input.setAttribute("class","question-item check-data isname");
                                //new_input.setAttribute("value",_name_found);
                            } else if(_running_login_option_question_personal[i]==2){
                                // Liên kết email
                                new_input.setAttribute("class","question-item check-data isemail");
                                //new_input.setAttribute("value",_email_found);
                            } else if(_running_login_option_question_personal[i]==6){
                                // Liên kết CMND
                                new_input.setAttribute("class","question-item check-data iscmnd");
                                //new_input.setAttribute("value",_cmnd_found);
                            }
                            else if(_running_login_option_question_personal[i]==3){
                                // Liên kết phone
                                new_input.setAttribute("class","question-item check-data isphone");
                                //new_input.setAttribute("value",_phone_found);
                            } else if(_running_login_option_question_personal[i]==5){
                                // Liên kết ngày sinh
                                new_input.setAttribute("class","question-item check-data isbirthday");
                            }
                            else if(_running_login_option_question_personal[i]==7){
                                // Liên kết ngày sinh (ngày + tháng)
                                input_day = document.createElement("input");
                                input_day.setAttribute("type","text");
                                input_day.setAttribute("class","question-item");
                                input_day.setAttribute("data", quItem);
                                input_day.setAttribute("placeholder", "Ngày sinh");
                                input_day.setAttribute("isrequired", _running_login_option_question_required[i]);
                                input_day.setAttribute("class","question-item check-data isbirthdaydate birthday-day");

                                input_month = document.createElement("input");
                                input_month.setAttribute("type","text");
                                input_month.setAttribute("class","question-item");
                                input_month.setAttribute("data", quItem);
                                input_month.setAttribute("placeholder","Tháng sinh");
                                input_month.setAttribute("isrequired", _running_login_option_question_required[i]);
                                input_month.setAttribute("class","question-item check-data isbirthdaydate birthday-month");

                                input_div = document.createElement("div");
                                input_div.setAttribute("class", "question-item-birthday-pane");
                                input_div.appendChild(input_day);
                                input_div.appendChild(input_month);
                            }
                            else if(_running_login_option_question_personal[i]==8){
                                // Liên kết ngày sinh (ngày + tháng + năm)
                                input_day = document.createElement("input");
                                input_day.setAttribute("type","text");
                                input_day.setAttribute("class","question-item");
                                input_day.setAttribute("data", quItem);
                                input_day.setAttribute("placeholder", "Ngày sinh");
                                input_day.setAttribute("isrequired", _running_login_option_question_required[i]);
                                input_day.setAttribute("class","question-item check-data isbirthdayfull birthday-day");

                                input_month = document.createElement("input");
                                input_month.setAttribute("type","text");
                                input_month.setAttribute("class","question-item");
                                input_month.setAttribute("data", quItem);
                                input_month.setAttribute("placeholder", "Tháng sinh");
                                input_month.setAttribute("isrequired", _running_login_option_question_required[i]);
                                input_month.setAttribute("class","question-item check-data isbirthdayfull birthday-month");

                                input_year = document.createElement("input");
                                input_year.setAttribute("type","text");
                                input_year.setAttribute("class","question-item");
                                input_year.setAttribute("data", quItem);
                                input_year.setAttribute("placeholder", "Năm sinh");
                                input_year.setAttribute("isrequired", _running_login_option_question_required[i]);
                                input_year.setAttribute("class","question-item check-data isbirthdayfull birthday-year");

                                input_div = document.createElement("div");
                                input_div.setAttribute("class", "question-item-birthday-pane");
                                input_div.appendChild(input_day);
                                input_div.appendChild(input_month);
                                input_div.appendChild(input_year);
                            }
                            if(input_day!='' && input_month!='' && input_year!=''){
                                divObjQuestion.appendChild(input_div);
                            }
                            else if(input_day!='' && input_month!=''){
                                divObjQuestion.appendChild(input_div);
                            }else{
                                divObjQuestion.appendChild(new_input);
                            }
                        }
                        // CHECK BOX
                        else if(typeItem==_input_type_checkbox){
                            var new_el = document.createElement("span");
                            new_el.setAttribute("class","question-item-list-checkbox");
                            new_el.setAttribute("data",quItem);
                            new_el.setAttribute("isrequired", _running_login_option_question_required[i]);
                            new_el.setAttribute("goal_id", _running_login_option_question_goal_id[i]);

                            var vlItems = vlItem.split('{[*]}');
                            var vlItemsLen = vlItems.length;
                            for(var j = 0 ; j < vlItemsLen ; j++){
                                var new_input = document.createElement("input");
                                new_input.setAttribute("type","checkbox");
                                new_input.setAttribute("data",vlItems[j]);
                                new_el.appendChild(new_input);

                                var new_input_vl = document.createElement("label");
                                new_input_vl.innerHTML = vlItems[j];
                                new_el.appendChild(new_input_vl);

                                var new_line = document.createElement("br");
                                new_el.appendChild(new_line);
                            }
                            //nghiệp 15/12/20017 Rating
                            divObjQuestion.appendChild(new_el);
                            //quObj.parentNode.insertBefore(new_el, quObj);
                        }
                        // RADIO
                        else if(typeItem==_input_type_radio){
                            var radio_name = 'radio_' + new Date().getDate()
                                + '_' + new Date().getMonth()
                                + '_' + new Date().getFullYear()
                                + '_' + new Date().getHours()
                                + '_' + new Date().getMinutes()
                                + '_' + new Date().getSeconds()
                                + '_' + new Date().getMilliseconds()
                                + '_' + Math.floor(Math.random() * (999999 - 9999) + 9999);

                            var new_el = document.createElement("span");
                            new_el.setAttribute("class","question-item-list-radio");
                            new_el.setAttribute("data",quItem);
                            new_el.setAttribute("radio_name",radio_name);
                            new_el.setAttribute("isrequired", _running_login_option_question_required[i]);
                            new_el.setAttribute("goal_id", _running_login_option_question_goal_id[i]);

                            var vlItems = vlItem.split('{[*]}');
                            var vlItemsLen = vlItems.length;
                            for(var j = 0 ; j < vlItemsLen ; j++){
                                var new_input = document.createElement("input");
                                new_input.setAttribute("name",radio_name);
                                new_input.setAttribute("type","radio");
                                new_input.setAttribute("data",vlItems[j]);
                                if(_running_login_option_question_personal[i]==4){
                                    // Liên kết giới tính
                                    new_input.setAttribute("class","check-data isgender");
                                    if(_gender_found=='1' && vlItems[j]=='Nam'){
                                        new_input.setAttribute("checked",'checked');
                                    }
                                    else if(_gender_found=='0' && vlItems[j]=='Nữ'){
                                        new_input.setAttribute("checked",'checked');
                                    }
                                }
                                new_el.appendChild(new_input);

                                var new_input_vl = document.createElement("label");
                                new_input_vl.innerHTML = vlItems[j];
                                new_el.appendChild(new_input_vl);

                                var new_line = document.createElement("br");
                                new_el.appendChild(new_line);
                            }
                            //nghiệp 15/12/20017 Rating
                            divObjQuestion.appendChild(new_el);
                            //quObj.parentNode.insertBefore(new_el, quObj);
                        }
                        // SELECT
                        else if (typeItem == _input_type_select) {
                            var new_el = document.createElement("select");
                            new_el.setAttribute("class","question-item-select");
                            new_el.setAttribute("data",quItem);
                            new_el.setAttribute("isrequired", _running_login_option_question_required[i]);
                            new_el.setAttribute("goal_id", _running_login_option_question_goal_id[i]);

                            var new_inputET = document.createElement("option");
                            new_inputET.innerHTML = '--- Chọn ----';
                            new_inputET.setAttribute("value","");
                            new_inputET.setAttribute("selected","selected");
                            new_el.appendChild(new_inputET);

                            var vlItems = vlItem.split('{[*]}');
                            var vlItemsLen = vlItems.length;
                            for(var j = 0 ; j < vlItemsLen ; j++){
                                var new_input = document.createElement("option");
                                new_input.innerHTML = vlItems[j];
                                new_input.setAttribute("value",vlItems[j]);
                                new_el.appendChild(new_input);
                            }
                            //nghiệp 15/12/20017 Rating
                            divObjQuestion.appendChild(new_el);
                            //quObj.parentNode.insertBefore(new_el, quObj);
                        }
                        //nghiệp 15/12/20017 Rating
                        // RATING
                        else if(typeItem === _input_type_rating) {
                            var numberStar = parseInt(vlItem);

                            var starsPane = document.createElement("div");
                            starsPane.setAttribute("class","starsPane");

                            var newEl = document.createElement("div");
                            newEl.setAttribute("id", "id_"+_running_login_option_question_ids[i]);
                            newEl.setAttribute("class", "stars rating_stars_group");
                            newEl.setAttribute("data", quItem);
                            newEl.setAttribute("isrequired", _running_login_option_question_required[i]);
                            newEl.setAttribute("question_id", _running_login_option_question_ids[i]);
                            newEl.setAttribute("style", "width: " + (numberStar * 30) + 'px;');
                            var subNewEl = null;

                            for (var j = 1; j <= numberStar; j++) {
                                // radio button
                                subNewEl = document.createElement("input");
                                subNewEl.setAttribute("type", "radio");
                                subNewEl.setAttribute("name", "star_"+i);
                                subNewEl.setAttribute("value", j);
                                subNewEl.setAttribute("class", "rating star-" + j);
                                subNewEl.setAttribute("id", "star_"  + i + '_' + j);
                                newEl.appendChild(subNewEl);
                                // lable
                                subNewEl = document.createElement("label");
                                subNewEl.setAttribute("class", "star-" + j);
                                subNewEl.setAttribute("for", "star_" + i + '_' + j);
                                subNewEl.innerHTML = '' + j;
                                newEl.appendChild(subNewEl);
                            }
                            starsPane.appendChild(newEl);
                            subNewEl = document.createElement("span");
                            newEl.appendChild(subNewEl);
                            divObjQuestion.appendChild(starsPane);
                            //quObj.parentNode.insertBefore(newEl, quObj);
                        }
                    }
                    quObj.remove();
                    //nghiệp 15/12/20017 Rating
                    if (resize) {
                        resize();
                    }
                }catch(e){}
            }
            // Thu thập thông tin người dùng
            else if (_running_login_option.indexOf('z-add-') != -1){
                try{
                    var quObj = document.getElementById('for-login-question-temp');
                    // Thu thập điện thoại (nếu chưa có)
                    if(_mac_phone_found=='0' && _running_login_option.indexOf('z-add-phone') != -1){
                        var quItem = _running_login_option_question[i];
                        var new_input = document.createElement("input");
                        new_input.setAttribute("type","text");
                        new_input.setAttribute("class","question-item");
                        new_input.setAttribute("placeholder","Nhập số điện thoại để vào wifi");
                        quObj.parentNode.insertBefore(new_input, quObj);
                    }
                    // Thu thập tên (nếu chưa có)
                    else if(_mac_name_found=='0' && _running_login_option.indexOf('z-add-name') != -1){
                        var quItem = _running_login_option_question[i];
                        var new_input = document.createElement("input");
                        new_input.setAttribute("type","text");
                        new_input.setAttribute("class","question-item");
                        new_input.setAttribute("placeholder","Nhập họ & tên để vào wifi");
                        quObj.parentNode.insertBefore(new_input, quObj);
                    }
                    // Thu thập CMND (nếu chưa có)
                    else if(_mac_cmnd_found=='0' && _running_login_option.indexOf('z-add-cmnd') != -1){
                        var quItem = _running_login_option_question[i];
                        var new_input = document.createElement("input");
                        new_input.setAttribute("type","text");
                        new_input.setAttribute("class","question-item");
                        new_input.setAttribute("placeholder","Nhập số CMND để vào wifi");
                        quObj.parentNode.insertBefore(new_input, quObj);
                    }

                        // Thu thập email (nếu chưa có)
                    else if(_mac_email_found=='0' && _running_login_option.indexOf('z-add-email') != -1){
                        var quItem = _running_login_option_question[i];
                        var new_input = document.createElement("input");
                        new_input.setAttribute("type","text");
                        new_input.setAttribute("class","question-item");
                        new_input.setAttribute("placeholder","Nhập Email để vào wifi");
                        quObj.parentNode.insertBefore(new_input, quObj);
                    }
                        // Thu thập giới tính (nếu chưa có)
                    else if(_mac_gender_found=='0' && _running_login_option.indexOf('z-add-gender') != -1){
                        var quItem = _running_login_option_question[i];
                        var new_input = document.createElement("input");
                        new_input.setAttribute("type","text");
                        new_input.setAttribute("class","question-item");
                        new_input.setAttribute("placeholder","Bạn là NAM hay NỮ?");
                        quObj.parentNode.insertBefore(new_input, quObj);
                    }
                    // Thu thập năm sinh (nếu chưa có)
                    else if(_mac_birthday_year_found=='0' && _running_login_option.indexOf('z-add-birthday') != -1){
                        var quItem = _running_login_option_question[i];
                        var new_input = document.createElement("input");
                        new_input.setAttribute("type","text");
                        new_input.setAttribute("class","question-item birthday-year");
                        new_input.setAttribute("placeholder","Nhập năm sinh để vào wifi?");
                        quObj.parentNode.insertBefore(new_input, quObj);
                    }
                    // Thu thập ngày sinh (nếu chưa có)
                    else if(_mac_birthday_date_found=='0' && _running_login_option.indexOf('z-add-datebirthday') != -1){
                        var quItem = _running_login_option_question[i];
                        var new_input = document.createElement("input");
                        new_input.setAttribute("type","text");
                        new_input.setAttribute("class","question-item birthday-day");
                        new_input.setAttribute("placeholder","Ngày sinh?");
                        quObj.parentNode.insertBefore(new_input, quObj);

                        var new_input2 = document.createElement("input");
                        new_input2.setAttribute("type","text");
                        new_input2.setAttribute("class","question-item birthday-month");
                        new_input2.setAttribute("placeholder","Tháng sinh?");
                        quObj.parentNode.insertBefore(new_input2, quObj);
                    }
                    // Thu thập ngày tháng năm sinh (nếu chưa có)
                    else if((_mac_birthday_date_found=='0' || _mac_birthday_year_found=='0') && _running_login_option.indexOf('z-add-fullbirthday') != -1){
                        var quItem = _running_login_option_question[i];

                        var new_input = document.createElement("input");
                        new_input.setAttribute("type","text");
                        new_input.setAttribute("class","question-item birthday-day");
                        new_input.setAttribute("placeholder","Ngày sinh?");
                        quObj.parentNode.insertBefore(new_input, quObj);

                        var new_input2 = document.createElement("input");
                        new_input2.setAttribute("type","text");
                        new_input2.setAttribute("class","question-item birthday-month");
                        new_input2.setAttribute("placeholder","Tháng sinh?");
                        quObj.parentNode.insertBefore(new_input2, quObj);

                        var new_input3 = document.createElement("input");
                        new_input3.setAttribute("type","text");
                        new_input3.setAttribute("class","question-item birthday-year");
                        new_input3.setAttribute("placeholder","Năm sinh?");
                        quObj.parentNode.insertBefore(new_input3, quObj);
                    }
                    // Đã đủ hết thông tin
                    else{
                        _running_login_option = _running_login_option.replace('z-add-phone','button');
                        _running_login_option = _running_login_option.replace('z-add-name','button');
                        _running_login_option = _running_login_option.replace('z-add-cmnd','button');
                        _running_login_option = _running_login_option.replace('z-add-email','button');
                        _running_login_option = _running_login_option.replace('z-add-gender','button');
                        _running_login_option = _running_login_option.replace('z-add-birthday','button');
                        _running_login_option = _running_login_option.replace('z-add-datebirthday','button');
                        _running_login_option = _running_login_option.replace('z-add-fullbirthday','button');
                    }
                    quObj.remove();
                }catch(e){}
            }
            else
            {
                try{document.getElementById('for-login-question-temp').remove();}catch(e){}
            }

            // Gửi mã code qua EMAIL hoặc SMS hoặ ZALO
            if (_running_login_option.indexOf('time-out-code-email') == -1 && _running_login_option.indexOf('time-out-code-sms') == -1 && _running_login_option.indexOf('time-out-code-zns') == -1){
                try{document.getElementById('for-login-code-email').remove();}catch(e){}
                try{document.getElementById('for-login-code-email-or-phone').remove();}catch(e){}
                try{document.getElementById('for-login-code').remove();}catch(e){}
                try{document.getElementById('for-login-request-code-button').remove();}catch(e){}
            }else{
                // Email
                if(_running_login_option.indexOf('time-out-code-email') != -1){
                    try{
                        try{document.getElementById('for-login-code').remove();}catch(e){}
                        try{document.getElementById('for-login-request-code-button').remove();}catch(e){}
                        try{
                            document.getElementById('for-login-code-email-or-phone').setAttribute('placeholder','Nhập email của bạn');
                            document.getElementById('for-login-code-email-or-phone').setAttribute('style','text-align:center');
                        }catch(e){}
                    }catch(e){}
                }
                // SMS
                else if(_running_login_option.indexOf('time-out-code-sms') != -1){
                    try{
                        if(_mac_phone_verify==1){
                            try{document.getElementById('for-login-code-email').remove();}catch(e){}
                            try{document.getElementById('for-login-code-email-or-phone').remove();}catch(e){}
                            try{document.getElementById('for-login-code').remove();}catch(e){}
                            try{document.getElementById('for-login-request-code-button').remove();}catch(e){}
                            _login_option_used = '1';
                            _running_login_option = 'button';
                        }
                        //document.getElementById('for-login-code-email-or-phone').setAttribute("placeholder","Số điện thoại nhận code");
                    }catch(e){}
                }
                // Zalo MS
                else if(_running_login_option.indexOf('time-out-code-zns') != -1){
                    try{
                        if(_mac_phone_verify==1){
                            try{document.getElementById('for-login-code-email').remove();}catch(e){}
                            try{document.getElementById('for-login-code-email-or-phone').remove();}catch(e){}
                            try{document.getElementById('for-login-code').remove();}catch(e){}
                            try{document.getElementById('for-login-request-code-button').remove();}catch(e){}
                            _login_option_used = '1';
                            _running_login_option = 'button';
                        }
                        //document.getElementById('for-login-code-email-or-phone').setAttribute("placeholder","Số điện thoại nhận code");
                    }catch(e){}
                }
            }

            // Tự động đăng nhập
            if (_running_login_option.indexOf('auto') != -1) {
                _login_option_used = '0';
                try{
                    document.getElementsByClassName('for-login-el').remove();
                }catch(e){}
            }
        }

        // Click on login button event handler
        function ClickOnLoginButton() {
            var cc = false;
            // Token
            if (_running_login_option.indexOf("token")!=-1) {
                _login_option_used = '14';
                var token = document.getElementById('for-login-token').value;
                if(token.length>0){
                    CheckDataForLogin();
                }else{
                    cc = true;
                }
            }else{
                cc = true;
            }
            // Account
            if (_running_login_option.indexOf("account")!=-1 && cc) {
                _login_option_used = '15';
                var uid = document.getElementById('for-login-uid').value;
                var pwd = document.getElementById('for-login-pwd').value;
                if(uid.length>0 && pwd.length>0){
                    cc = false;
                    CheckDataForLogin();
                }else{
                    cc = true;
                }
            }else{
                cc = true;
            }

            // Active Directory Users
            if (_running_login_option.indexOf("active_directory_users")!=-1 && cc) {
                var uid = document.getElementById('for-login-uid').value;
                var pwd = document.getElementById('for-login-pwd').value;
                if(uid.length>0 && pwd.length>0){
                    cc = false;
                    LoginToWifi();
                }else{
                    cc = true;
                }
            }else{
                cc = true;
            }

            // Lấy mã code qua sms
            if (_running_login_option.indexOf('time-out-code-sms')!=-1 && cc) {
                _login_option_used = '5';
                var _code = document.getElementById('for-login-code').value;
                if(_code.length>0){
                    cc = false;
                    CheckDataForLogin();
                }else{
                    cc = true;
                }
            }else{
                cc = true;
            }

            // Lấy mã code qua sms
            if (_running_login_option.indexOf('time-out-code-zns')!=-1 && cc) {
                _login_option_used = '17';
                var _code = document.getElementById('for-login-code').value;
                if(_code.length>0){
                    cc = false;
                    CheckDataForLogin();
                }else{
                    cc = true;
                }
            }else{
                cc = true;
            }

            // Đăng nhập 2 bước qua email xác thực
            if (_running_login_option.indexOf('time-out-code-email')!=-1 && cc) {
                _login_option_used = '16';
                cc = false;
                CreateLoginCodeAndMail();
            }else{
                cc = true;
            }

            // Question & Thu thập thông tin
            if ((_running_login_option.indexOf("questionaire")!=-1 ||
                _running_login_option.indexOf("z-add-")!=-1) && cc) {
                SaveAnswerData();
            }

            // Button
            if(_running_login_option.indexOf("button")!=-1 && cc) {
                _login_option_used = '1';
                LoginToWifi();
            }
        }

        // Click on request code butotn event handler
        function ClickOnRequestButton(){
            if(_running_login_option.indexOf('time-out-code-email') != -1){
                CreateLoginCodeAndMail();
            }
            else if(_running_login_option.indexOf('time-out-code-zns') != -1){
                CreateLoginCodeAndZaloMS();
            }
            else{
                CreateLoginCodeAndSMS();
            }
        }

        // FIRST START > DOCUMENT READY
        document.addEventListener('DOMContentLoaded', function () {

            // View int
            ViewInit();

            // Callback from ThirdParty Splashpage
            if(GetQueryString("thirdparty_splashpage_callback")==1){
                LoginToWifi();
            }
            else
            {
                if (document.getElementById('for-login-button')) {
                    // If sunmit button exist > set click event on submit button
                    document.getElementById('for-login-button').addEventListener('click', ClickOnLoginButton, false);
                } else {
                    // If submit button does not exist and login option is auto > call login wifi
                    if(_running_login_option.indexOf('auto') != -1){
                        LoginToWifi();
                    }
                }
                if (document.getElementById('for-login-request-code-button')) {
                    document.getElementById('for-login-request-code-button').addEventListener('click', ClickOnRequestButton, false);
                }

                // If login using facebook exist > set click event on it
                if(document.getElementById('for-login-social-facebook')){
                    document.getElementById('for-login-social-facebook').addEventListener('click', LoginToFacebook, false);
                }

                // Count down to login if exist
                if(_running_client_mac!="monitor" && _running_auto_action>0){
                    _login_option_used = '0';
                    var Timeout = _running_auto_action*1000;    // mili sec
                    AutoSecBegin = _running_auto_action;        // sec
                    $('#waiting5s').css('display','block');
                    setTimeout("LoginToWifi()", Timeout);
                    $('#waiting5s').animate({
                        width: '0px'
                    },Timeout);
                    var AutoInterval = setInterval(function(){
                        AutoSecBegin--;
                        if(AutoSecBegin==0){
                            clearInterval(AutoInterval);
                            $('#waiting5s p').html('');
                        }else{
                            $('#waiting5s p').html('Chờ '+AutoSecBegin+' giây');
                        }
                    }, 1000);
                }
            }

            // Click from email
            if(GetQueryString("_t_c_f_lg_is")!=''){
                try{
                    var _t_c_f_lg_is_vl = GetQueryString("_t_c_f_lg_is");
                    document.getElementById('for-login-code').value = _t_c_f_lg_is_vl;
                    CheckDataForLogin();
                }catch(e){}
            }

        }, false);

        /*
            ==============
            MORE FUNCTIONS
            ==============
        */

        // Kiểm tra chuỗi Ngày/Tháng/Năm đúng hay sai
        function CheckDate(strDate) {
            var comp = strDate.split('/')
            var d = parseInt(comp[0], 10)
            var m = parseInt(comp[1], 10)
            var y = parseInt(comp[2], 10)
            var date = new Date(y,m-1,d);
            if (date.getFullYear() == y && date.getMonth() + 1 == m && 		        date.getDate() == d) {
                return true
            }
            return false
        }setTimeout("")

        // Check phone number right or wrong
        function CheckPhone(phone) {
            phone = phone.replace(/[^0-9]/g, '');
            var numbers = /^[0-9]+$/;
            if (!phone.match(numbers)) {
                return false;
            }
            else
            {
                if (phone.length != 10) {
                    return false;
                }
                else {
                    var first = phone.substr(0, 3);
                    if (
                        first != "096" && first!="097" && first!="098" &&
                        first != "089" && first!="090" && first!="093" &&
                        first != "088" && first!="091" && first!="094" &&
                        first != "092" && first!="056" && first!="058" && first!="052" &&
                        first != "032" && first!="033" && first!="034" && first!="035" && first!="036" && first!="037" && first!="038" && first!="039" &&
                        first != "070" && first!="076" && first!="077" && first!="078" && first!="079" &&
                        first != "081" && first!="082" && first!="083" && first!="084" && first!="085" && first!="086" && first!="087" && first!="088" && first!="089" &&
                        first != "056" && first!="058" && first!="059" && first!="099"
                        ) {
                        return false;
                    }
                    else {
                        return true;
                    }
                }

            }
        }

        // Check ngày tháng
        function CheckBirthday(inp) {
            if(!inp.includes('/')) { return false; }
            var components = inp.split('/');
            if(components.length < 3) { return false; }
            if(components.length > 3) { return false; }
            if(components[0].length > 2 || components[1].length > 2 || components[2].length != 4) { return false; }
            if(Number.isNaN(components[0]) || Number.isNaN(components[1]) || Number.isNaN(components[2])) { return false; }
            var day = Number(components[0]),
                month = Number(components[1]),
                year = Number(components[2]);
            if(!Number.isInteger(day) || !Number.isInteger(month) || !Number.isInteger(year)) { return false; }
            if(day < 1 || month < 1 || year < 1000) { return false; }
            var now = new Date();
            var now_month = now.getMonth() + 1;
            if(day > 31 || month > 12 || year >= now.getFullYear()) { return false; }
            if(year == now.getFullYear() && (month > now_month || (month == month && day >= now.getDate()))) { return false; }
            var isLeapYear = function (y) { return ((year % 4 == 0) && (year % 100 != 0)) || (year % 400 == 0); };
            if(!isLeapYear(year) && month == 2 && day > 28) { return false; }
            return true;
        }

        // Check email right or wrong
        function CheckEmail(email){
            email = email.replace(/ /g, '');
            var reg = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return reg.test(email);
        }

        // Assign remove method in HTML DOM
        Element.prototype.remove = function () {
            this.parentElement.removeChild(this);
        }
        NodeList.prototype.remove = HTMLCollection.prototype.remove = function () {
            for (var i = this.length - 1; i >= 0; i--) {
                if (this[i] && this[i].parentElement) {
                    this[i].parentElement.removeChild(this[i]);
                }
            }
        }
        String.prototype.replaceAllAndTrim = function(search, replacement) {
            var target = this;
            while(target.indexOf(search)!=-1){
                target = target.replace(new RegExp(search, 'g'), replacement);
            }
            return target.trim();
        };

        // Get value of a querystring
        function GetQueryString(name) {
            name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
            var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
			    results = regex.exec(location.search);
            return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
        }

        // Show Message
        function _show_message(_text){
            document.getElementById('for-process-loading').style.display = 'none';
            document.getElementById('for-process-loading-img').style.display = 'none';
            if(_text!=''){
                document.getElementById('for-login-message').innerHTML= _text;
            }
            else if (_running_login_option.indexOf('account') != -1 || _running_login_option.indexOf('active_directory_users') != -1) {
                document.getElementById('for-login-message').innerHTML= "Sai tài khoản hoặc mật khẩu!";
            }
            else
            {
                document.getElementById('for-login-message').innerHTML= "Không thể đăng nhập WIFI !!";
            }
        }

    </script>

    <!-- TEMPLATE -->
    <style>
        #surveyFrame{position:absolute;z-index:-1;opacity:0}
        #freeads{
            margin:0px;padding:0px;position:absolute;z-index:999999999;
            top:0px;
            left:0px;
            width:100%;
            height:90px;
            background:#26b99c;
        }
        #freeads img{
            margin:0 auto;
            display:block;
            height:90px;
        }
        @media screen and (max-width:769px) {
            #freeads{height:50px}
            #freeads img{height:50px}
        }
    </style>
    
    <!--
    LƯU Ý CHO NGƯỜI PHÁT TRIỂN TEMPALTE
    ***********************************

    1. Đối với các thẻ HTML có thuộc tính protected="1"
       - Không được xóa thẻ
       - Không được thay đổi giá trị thuộc tính id
       - Không được xóa bỏ giá trị đang có của thuộc tính class (nhưng có thể thêm vô)
       - Không được đổi loại thẻ (div, p, ...), đang là thẻ gì thì giữ nguyên vậy
       - Không được đổi thuộc tính type nếu là thẻ input

    2. Cẩn thận với Javascript vì nó có thể làm template không hoạt động đúng. Chỉ nên sử dụng
       khi thực sự quá cần thiết. (để làm hiệu ứng, ...)

    6. Đây là danh sách định dạng các giá trị động mà bạn sẽ cần trong quá trình thiết kế HTML template:

       http://cdn2.vnwifi.vn/templates/users/demo/iao-din--uyn-/version_1 : trả về đường dẫn URL đến thư mục template của bạn.
            VÍ DỤ: <img src="http://cdn2.vnwifi.vn/templates/users/demo/iao-din--uyn-/version_1/your_image.jpg" />
            KHI CHẠY: <img src="http://example.com/templates/your_template/your_version/your_image.jpg" />
       http://cloud2.vnwifi.vn : trả về tên miền và protocol đang chạy.
            VÍ DỤ: https://your_domain.com
       adwdawdaw : Họ và tên của người dùng (nếu có)
       testwifi@dut.udn.vn : Email của người dùng (nếu có)
       0965854753 : Số phone của người dùng (nếu có)
       https://lh3.googleusercontent.com/a/AAcHTtc_7jW-wuZLk20W1GYqe7_cqf4Gu7rZNi_jYZ4rIQmS=s96-c : ảnh của người dùng (nếu có)
       nam : ra chữ nam hoặc nữ tương ứng với giới tính người dùng. Nếu chưa rõ sẽ ra chữ nam/nữ
       anh : ra chữ anh hoặc chị tương ứng với giới tính người dùng. Nếu chưa rõ sẽ ra chữ anh/chị
-->
<style>
    body {
        margin: 0px;
        padding: 0px;
        width: 100vw;
        height: 100vh;
    }

    .BG {
        margin: 0;
        padding: 0;
        width: 100vw;
        height: 100vh;
        background-position: center center;
        background-size: cover;
        background-repeat: no-repeat;
        position: fixed;
        z-index: 1;
        opacity: 0;
        
        filter: blur(1em) brightness(1.2);
        -o-filter: blur(1em) brightness(1.2);
        -ms-filter: blur(1em) brightness(1.2);
        -moz-filter: blur(1em) brightness(1.2);
        -webkit-filter: blur(1em) brightness(1.2);
        
    }

    #BG1 {
        opacity: 1;
    }

    /* Nội dung */
    #Container {
        margin: 0 auto;
        position: relative;
        top: 50%;
        transform: translateY(-50%);
        max-width: 600px;
        overflow-x: hidden;
        z-index: 2;
    }
    .dontmove{
        top:0;
        transform: translateY(0);
    }

    .Banner {
        margin: 0 auto;
        width: 95%;
        display: block;
        margin-bottom: 10px;
    }

        .Banner.Data {
            position: absolute;
            top: 0px;
            left: 100%;
            z-index: 2;
            opacity: 0;
        }

    #Banner1 {
        opacity: 1;
        left: 2.5%;
    }

    #scroll {
        margin: 0;
        padding: 0;
        width: 0%;
        height: 5px;
        position: absolute;
        top: -2px;
        left: 2.5%;
        z-index: 3;
        background-color: #b41718;
    }

    #for-login-button2 {
        margin: 0 auto;
        width: 250px;
        text-align: center;
        padding: 10px 0px;
        border-radius: 10px;
        color: #fff;
        font-size: 18px;
        line-height: 1;
        cursor: pointer;
    }

    .btb1 {
        background: #008CBA;
    }

        .btb1:hover {
            background: #29b4e1;
        }

    .btb2 {
        background: #333;
    }

        .btb2:hover {
            background: #000;
        }

    input.question-item {
        display: block;
        margin: 0 auto;
        margin-bottom: 10px;
        padding: 10px 0px;
        text-align: center;
        font-size: 15px;
        border: 1px solid #ccc;
        border-radius: 3px;
        width: 95%;
    }

    .question_label {
        display: none;
    }

    #for-login-message {
        margin: 10px 0 0 0;
        padding: 0;
        color:#000;
        font-size: 12px;
        text-align: center;
        display: none;
    }
    #txtName, #txtPhone{
        display:none;
    }
</style>

<div class="BG" id="BG1" style="background-image: url('http://truongpham.id.vn/wifi/login/templates/d20240617m1.jpg')"></div>
<!--<div class="BG" id="BG2" style="background-image: url('http://cdn2.vnwifi.vn/templates/users/demo/iao-din--uyn-/version_1/B2BG.jpg')"></div>-->

<div id="Container">
    <img src="http://truongpham.id.vn/wifi/login/templates/Empty600x800.png" id="Empty600x800" class="Banner" />
    <div id="scroll"></div>
    
    <img src="http://truongpham.id.vn/wifi/login/templates/d20240617m1.jpg" id="Banner1" class="Banner Data" />
    <!--<img src="http://cdn2.vnwifi.vn/templates/users/demo/iao-din--uyn-/version_1/B2.jpg" id="Banner2" class="Banner Data" />  -->
    
    <!--<input type="text" id="txtName" class="question-item" placeholder="Họ và tên" />-->
    <!--<input type="text" id="txtPhone" class="question-item" placeholder="Số điện thoại" />-->
	<p style="text-align: center;background-color: #ffffff;padding: 5px 0px 5px 0px;border: 1px solid #dee2e6;border-radius: 5px;box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);margin: 10px;font-size: small;">ĐỂ TRUY CẬP WIFI FREE KHÁCH HÀNG VÀO ZALO<br>NHẤN <strong>QUAN TÂM</strong> BỆNH VIỆN ĐA KHOA XUYÊN Á</p>
    <div id="for-login-button2" class="btb1" onclick="LoginToWifi()">TRUY CẬP ZALO </div>
    <p id="for-login-message" protected="1"></p>
</div>
<div id="for-login-button" style="display:none;position:absolute;z-index:-1;opacity:0" class="btb1">CONNECT WIFI</div>
<script>

    // Thời gian chuyển slide (mili giây)
    var timeout = 300;
    
    // Thời gian dừng lại mỗi lần chuyển (mili giây)
    var waiting = 3000;
    
    // Chỉ số slide banner
    var c_index = 1;
    var m_index = 1;
    
    // Khởi chạy
    document.addEventListener('DOMContentLoaded', function () {
        m_index = $('img.Banner.Data').length;
        AutoDetectSize();
        // SetupQuestionForm();
        if(m_index > 1){
            setTimeout("GoNext()", waiting);
            $('#scroll').stop(true).animate({ width: '95%' }, waiting);
        }
    }, false);

    // Hiển thị thu thập thông tin
    function SetupQuestionForm() {
        if(_running_login_option_question_answred == '0'){
            $('#for-login-message').text('(*) Tất cả thông tin là bắt buộc').css('display','block');
            $('#txtName').css('display', 'block');
            $('#txtPhone').css('display', 'block');
        }
    }

    // Tự đều chỉnh kích thước theo màn hình
    var AutoDetectSizeTimeHold;
    var OldHeight = 0;
    var OldWidth = 0;
    function AutoDetectSize() {
        try { clearTimeout(AutoDetectSizeTimeHold); } catch (e) { }
        var cHeight = $(window).height();
        var cWidth = $(window).width();
        if (cHeight != OldHeight || cWidth != OldWidth) {
            var leftH = 50//_running_login_option_question_answred == '1' ? 50 : 200;
            // --
            var xH = cHeight;
            var xW = 0;
            if (cHeight < 800) {
                $('#Container').addClass('dontmove');
            } 
            // --
            var xW = (6 * (xH - leftH)) / 8;
            if (xW > cWidth) {
                xW = cWidth;
            }
            if (xW < 300) xW = 300;
            // --
            $('#Container').stop(true).animate({
                width: xW + 'px'
            }, 300);
            OldHeight = cHeight;
            OldWidth = cWidth;
        }
        AutoDetectSizeTimeHold = setTimeout("AutoDetectSize()", 1000);
    }

    // Chuyển hình ảnh của slide
    function GoNext() {
        var n_index = c_index == m_index ? 1 : (c_index + 1);
        console.log('SLIDE ' + n_index);
        // BTB
        // $('#for-login-button').attr('class','btb'+n_index);
        // scroll
        $('#scroll').stop(true).animate({
            width: '0%'
        }, timeout);
        // Slide out
        $('#BG' + c_index).stop(true).animate({
            opacity:0
        }, timeout);
        $('#Banner' + c_index).stop(true).animate({
            left: '-100%',
            opacity: 0
        }, timeout, function () {
            $('#Banner' + c_index).css('left', '100%');
            c_index = n_index;
        });
        // Slide in
        $('#BG' + n_index).stop(true).animate({
            opacity: 1
        }, timeout);
        $('#Banner' + n_index).stop(true).animate({
            left: '2.5%',
            opacity: 1
        }, timeout, function () {
            setTimeout("GoNext()", waiting);
            $('#scroll').stop(true).animate({ width: '95%' }, waiting);
        });
    }

    // Lưu câu trả lời
    function SaveTheData() {
        if (_running_login_option_question_answred == '1') {
            _login_option_used = '1';
            LoginToWifi();
            return;
        }
        _login_option_used = '12';
        var name = $('#txtName').val();
        var phone = $('#txtPhone').val();
        if(name == ''){
            $('#for-login-message').text('Vui lòng nhập họ và tên').css('display','block');
            return;
        }
        if (phone == '') {
            $('#for-login-message').text('Vui lòng nhập số điện thoại').css('display','block');
            return;
        }
        if (!CheckPhone(phone)) {
            $('#for-login-message').text('Số điện thoại sai định dạng, vui lòng thử lại').css('display','block');
            return;
        }
        if (ViewEditMode) {
            $('#for-login-message').text('Chế độ xem thử tới đây là hết!').css('display','block');
            return;
        }
        document.getElementById('for-process-loading').style.display = 'block';
        document.getElementById('for-process-loading-img').style.display = 'block';
        var answer = 'Họ và tên[>]' + name + '[>]1[>]';
        //answer += '[*]Email[>]' + email + '[>]2[>]';
        answer += '[*]Số điện thoại[>]' + phone + '[>]3[>]';
        var form = new FormData();
        form.append('userid', _running_user_id);
        form.append('new_user', _mac_is_new_user);
        form.append('tracking_splash_id', _running_tracking_splash_id);
        form.append('groupid', _running_login_option_question_group);
        form.append('location_id', _running_location_id);
        form.append('client_mac', _running_client_mac);
        form.append('question_answer', answer);
        form.append('rating_value', '');
        form.append('option', '1');
        var xhr = new XMLHttpRequest();
        xhr.open("POST", _running_action_save_answer, true);
        xhr.timeout = 30000;
        xhr.ontimeout = function () {
            LoginToWifi();
        }
        xhr.onreadystatechange = function () {
            if (xhr.readyState == 4 && xhr.status == 200) {
                LoginToWifi();
            }
        }
        xhr.send(form);
    }

</script>
    <!-- FIXED -->
    <div id="for-process-loading" class="for-loading">&nbsp;</div>
    <div id="for-process-loading-img" class="for-loading">&nbsp;</div>
    <div id="waiting5s">
        <p style="margin:0px;padding:0px;min-width:150px">Chờ 0 giây</p>
    </div>   
    <!-- THÔNG BÁO THÀNH CÔNG --> 
    <style>
        #loginok{
            margin:0;
            padding:0;
            position:fixed;
            top:0px;
            left:0px;
            width:100vw;
            height:100vh;
            background:#ffffff;
            z-index:9999;
            display:none;
        }
        #loginokms{
            margin:0 auto;
            padding:0px;
            font-size:20px;
            color:#058760;
            text-align:center;
            width:300px;
            margin-top:50%;
            transform:translateY(-50%);
        }
        #loginokms p{
            margin:0 0 20px 0;
        }
    </style>
    <div id="loginok">
        <div id="loginokms">
            <p><i class="fa fa-check-circle" aria-hidden="true" style="font-size:50px"></i></p>
            <p>KẾT NỐI THÀNH CÔNG</p>
            <p style="color: #000000;font-size: 14px;">Đang chuyển hướng...</p>
        </div>
    </div>
    
</body>
</html>